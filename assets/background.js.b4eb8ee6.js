var o=!1,u=[],l;chrome.storage.local.get(["extras"]).then(e=>{var r;l=(r=e==null?void 0:e.extras)==null?void 0:r.galleryUrl});chrome.runtime.onMessage.addListener(function(e,r){e.pageAction==!0&&!chrome.runtime.lastError&&chrome.action.setIcon({tabId:r.tab.id,path:"assets/icons/16.png"}).then(function(){u.push(r.tab.id)})});chrome.action.onClicked.addListener(e=>{chrome.tabs.query({active:!0,currentWindow:!0}).then(r=>{var t=r[0];chrome.tabs.sendMessage(t.id,{iconClicked:!0,tab:t})})});chrome.runtime.onMessage.addListener(async(e,r)=>{e.action==="openOutput"?(chrome.tabs.update(r.tab.id,{url:e.url}),chrome.tabs.create({url:l||"./gallery.html",active:!0,index:r.tab.index+1}),c()):e.action==="openImageEditor"?chrome.tabs.create({url:"./wallpaper-creator.html?src=gallery",active:!0,index:r.tab.index+1}):e.action==="changeGalleryUrl"&&(l=e.url,c())});chrome.tabs.onActivated.addListener(e=>{chrome.runtime.lastError||u.indexOf(e.tabId)>-1||chrome.action.setIcon({tabId:e.tabId,path:"assets/icons-gray/16.png"}).then(function(){})});c();function c(){chrome.storage.local.get(["chunks","extras"]).then(e=>{var n;const r=(e==null?void 0:e.chunks)||[];r.length>0;const t=r.lastIndexOf("books")>-1,i=r.lastIndexOf("wishlist")>-1;o=(n=e==null?void 0:e.extras)==null?void 0:n["domain-extension"],e=null,chrome.contextMenus.removeAll();const a={id:"ale-to-audible",title:"1. Audible"+o+"/library",contexts:["all"]};o||(a.title="1. Audible.com/library (placeholder)"),chrome.contextMenus.create(a);const s={id:"ale-to-gallery",title:"2. Extension gallery",contexts:["all"]};t||i||(s.enabled=!1,s.title=s.title+" (available after extraction)"),chrome.contextMenus.create(s),chrome.contextMenus.create({id:"separator-1",type:"separator",contexts:["all"]}),chrome.contextMenus.create({id:"ale-to-docs",title:"3. Documentation",contexts:["all"]}),chrome.contextMenus.create({id:"ale-to-github",title:"4. Github project page",contexts:["all"]}),chrome.contextMenus.create({id:"ale-to-github-issues",title:"5. Github issues",contexts:["all"]}),chrome.contextMenus.create({id:"ale-to-github-discussions",title:"6. Github discussions",contexts:["all"]})})}chrome.contextMenus.onClicked.addListener(h);function h(e,r){var t={active:!0,index:r.index+1,openerTabId:r.id};e.menuItemId==="ale-to-audible"?o?(t.url="https://audible"+o+"/library/titles?ipRedirectOverride=true&overrideBaseCountry=true",chrome.tabs.create(t)):chrome.storage.local.get(["extras"]).then(i=>{var a;o=(a=i==null?void 0:i.extras)==null?void 0:a["domain-extension"],t.url="https://audible"+(o||".com")+"/library/titles?ipRedirectOverride=true&overrideBaseCountry=true",chrome.tabs.create(t)}):e.menuItemId==="ale-to-gallery"?(t.url=l||"./gallery.html",chrome.tabs.create(t)):e.menuItemId==="ale-to-docs"?(t.url="https://joonaspaakko.gitbook.io/audible-library-extractor/",chrome.tabs.create(t)):e.menuItemId==="ale-to-github"?(t.url="https://github.com/joonaspaakko/audible-library-extractor",chrome.tabs.create(t)):e.menuItemId==="ale-to-github-issues"?(t.url="https://github.com/joonaspaakko/audible-library-extractor/issues",chrome.tabs.create(t)):e.menuItemId==="ale-to-github-discussions"&&(t.url="https://github.com/joonaspaakko/audible-library-extractor/discussions",chrome.tabs.create(t))}
