import{o as m,c as x,a as g,_ as F,b as L,n as O,q as ae,r as E,l as J,T as te,s as C,t as M,d as U,i as A,e as T,g as le,G as se,u as Z,x as G,H as ce,F as ie,k as ne,v as ue,I as de,J as Q,K as ge,z as fe,$ as H,f as R,L as pe,M as he,N as me,O as be,P as _e,Q as ye,R as xe,S as ve,W as ke,U as Se,C as we,E as $e,X as De,V as Pe}from"./vendor.e7714c30.js";import{h as Y}from"./helpers.c1b1b2ae.js";import{t as Ce}from"./timeStringToSeconds.340b6df7.js";import{s as qe}from"./secondsToTimeString.bc24dd43.js";/* empty css              */const Ae={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Le=g("g",{fill:"none",stroke:"currentColor","stroke-width":"2"},[g("path",{d:"M21 12a9 9 0 1 1-18 0a9 9 0 0 1 18 0Z"}),g("path",{"stroke-linecap":"round",d:"m9 15l6-6m0 6L9 9"})],-1),Me=[Le];function Ne(e,t){return m(),x("svg",Ae,Me)}var Ie={name:"humbleicons-times-circle",render:Ne};const Oe={name:"overlay",data(){return{showLogo:!1,imageSources:{logo:chrome.runtime.getURL("assets/images/audible-library-extractor-logo.svg")}}},mounted:function(){this.showLogo=!0,document.querySelector("html").classList.add("ale-overlay-open")},methods:{closeOverlay:function(){window.location.reload()}}},Te={id:"audible-library-extractor"},Fe={class:"inner-wrap"},ze=["src"];function Be(e,t,s,i,o,n){const a=Ie;return m(),x("div",Te,[g("div",Fe,[g("div",{class:"close-btn",onClick:t[0]||(t[0]=r=>n.closeOverlay())},[L(a)]),g("div",{id:"the-adbl-logo",class:O({"fade-in-fwd":o.showLogo})},[g("img",{src:o.imageSources.logo,alt:""},null,8,ze)],2),ae(e.$slots,"default")])])}var Ue=F(Oe,[["render",Be]]);const He={name:"scrapingProgress",data(){return{store:this.$store.state,imageSources:{logo:chrome.runtime.getURL("assets/images/audible-library-extractor-logo.svg"),loader:chrome.runtime.getURL("assets/images/loader-64px.gif")}}},computed:{steps:function(){return this.store.progress.step>0?this.store.progress.step+" / "+this.store.progress.max:this.store.progress.max},bigSteps:function(){return this.store.bigStep.step>0?this.store.bigStep.step+" / "+this.store.bigStep.max:this.store.bigStep.max},subSteps:function(){return this.store.subStep.step>0?this.store.subStep.step+" / "+this.store.subStep.max:this.store.subStep.max},progressWidth:function(){return{width:this.store.progress.step/this.store.progress.max*100+"%"}}}},Re=e=>(Z("data-v-3874e31e"),e=e(),G(),e),Ee={id:"ale-progress-wrap"},je={class:"loader-image"},We=["src"],Ve={key:0,class:"step"},Ze={class:"ale-progress"},Ge={class:"ale-step-text"},Je={class:"ale-step-additional-info"},Qe={style:{"text-align":"center","margin-top":"20px",height:"110px"}},Ye=["src"],Xe=Re(()=>g("div",{class:"footnote"}," Keep this tab and the browser window on top until the extraction is completed. ",-1));function Ke(e,t,s,i,o,n){const a=E("visible");return m(),x("div",Ee,[L(te,{name:"fade"},{default:J(()=>[g("div",je,[g("img",{height:"72",src:o.imageSources.loader,alt:""},null,8,We)])]),_:1}),o.store.bigStep.title?(m(),x("div",{key:0,class:O(["ale-big-step",{"sub-step-exists":o.store.subStep.max>0}])},[g("h2",null,[C(M(o.store.bigStep.title)+"\xA0 ",1),o.store.subStep.max>0?(m(),x("small",Ve,"("+M(n.subSteps)+")",1)):U("",!0)])],2)):U("",!0),A((m(),x("div",Ze,[g("div",null,[g("div",Ge,[A((m(),x("div",Je,[C(M(o.store.progress.text2),1)])),[[a,o.store.progress.text2]]),C(" "+M(o.store.progress.text)+" ",1),n.steps?(m(),T(te,{key:0,name:"fade"},{default:J(()=>[g("span",null,M(n.steps),1)]),_:1})):U("",!0),C(" "+M(o.store.progress.textsuffix),1)])])])),[[a,o.store.progress.text]]),A((m(),x("div",{class:O(["ale-bar",{"scale-in-hor-center":o.store.progress.bar}])},[g("div",{class:"ale-step-line",style:le(n.progressWidth)},null,4)],2)),[[a,o.store.progress.bar&&o.store.progress.step&&o.store.progress.max]]),A(g("div",Qe,[g("img",{src:o.store.progress.thumbnail,alt:"",style:{"max-height":"110px"}},null,8,Ye)],512),[[se,o.store.progress.thumbnail]]),Xe])}var et=F(He,[["render",Ke],["__scopeId","data-v-3874e31e"]]);const tt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},st=g("g",{fill:"currentColor"},[g("path",{"fill-rule":"evenodd",d:"M12 19a7 7 0 1 0 0-14a7 7 0 0 0 0 14Zm0 3c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10Z","clip-rule":"evenodd",opacity:".2"}),g("path",{d:"M2 12C2 6.477 6.477 2 12 2v3a7 7 0 0 0-7 7H2Z"})],-1),it=[st];function nt(e,t){return m(),x("svg",tt,it)}var rt={name:"gg-spinner",render:nt};const ot={viewBox:"0 0 256 256",width:"1.2em",height:"1.2em"},at=g("path",{fill:"currentColor",d:"M71.7 97.2L34.8 128l36.9 30.8a12 12 0 1 1-15.4 18.4l-48-40a12 12 0 0 1 0-18.4l48-40a12 12 0 0 1 15.4 18.4Zm176 21.6l-48-40a12 12 0 0 0-15.4 18.4l37 30.8l-37 30.8a11.9 11.9 0 0 0-1.5 16.9a12.2 12.2 0 0 0 9.2 4.3a12 12 0 0 0 7.7-2.8l48-40a12 12 0 0 0 0-18.4Zm-83.6-90.1a12.1 12.1 0 0 0-15.4 7.2l-64 176a12.1 12.1 0 0 0 7.2 15.4a11.8 11.8 0 0 0 4.1.7a12 12 0 0 0 11.3-7.9l64-176a12.1 12.1 0 0 0-7.2-15.4Z"},null,-1),lt=[at];function ct(e,t){return m(),x("svg",ot,lt)}var ut={name:"ph-code-bold",render:ct};let v="https://github.com/joonaspaakko/audible-library-extractor/issues/";var dt={data:function(){return{changeLog:[{version:"v.0.2.9",highlights:"Full extraction recommended.",changes:[{description:"Up to this version the extension used to add global CSS styling that slightly modified the CSS in the library. It added very small unnoticable changes, like shifting text a little bit, but now it's fixed.",class:"fixed"}]},{version:"v.0.2.8",highlights:`The "Audible Library Extractor" button in Audible's website now looks like a button and was moved above the search input, because Audible continually made small changes and it could no longer fit where it used to be.`,changes:[{description:"Extraction comes up with 20 books (single page). Note: audible changed things",class:"fixed",link:{text:"Fixed #72",href:v+"72"}},{description:"Wishlist extraction discards all data and the wishlist gallery page comes up empty. Note: audible changed things",class:"fixed",link:{text:"Fixed #71",href:v+"71"}},{description:"Wallpaper creator showing a blank page (if used hadn't extracted collections).",class:"fixed",link:{text:"Fixed #69",href:v+"69"}},{description:'Some "unavailable" books not marked properly. Note: this bug was introduced in v.0.2.7',class:"fixed",link:{text:"Fixed #68",href:v+"68"}},{description:"Top menu disappears sometimes on certain pages bug",class:"fixed",link:{text:"Fixed #67",href:v+"67"}}]},{version:"v.0.2.7",highlights:`
            You should do a full extraction after updating to this version. There are a a few new data points that the partial extraction will not update to any old books.
            <br><br>
            I added global context menu items so you can easily open the gallery by right-clicking anywhere inside any tab and choose "Audible Library Extracor > Gallery page".
            <br><br>
            There's now a wallpaper creator in the extension gallery. Look for it in the top menu.
          `,changes:[{description:"Added import and export for raw data. Data is stored in your browser, but if you for example get a new computer you could export data on your current computer and import it on the new one and you don't have to do a full extraction.",class:"added"},{description:"Added dropdown list type filters, which allow you to filter books by properties like the language or format etc...",class:"added"},{description:"You can now collapse & expand book cover and information in the book details view.",class:"improved"},{description:`"My books in the library" list now shows you if any books you don't own are available in the Plus Catalog. Also you can now open book links to a new tab, which wasn't possible before. `,class:"improved"},{description:"Added genre / theme tags. These are little pill shaped text btns you see below the summary on some store pages.",class:"added"},{description:"Added better Archive handling. Filters and sorting for archived books. Standalone gallery now has an option to exclude archived books / archived collection.",class:"added"},{description:"Added whispersync data: 1. Color dot on the covers if you own the Kindle version. 2. Whispersync filters 3. Whispersync sorters 4. Whispersync label inside the book details view",class:"added"},{link:{text:"Fixed #66",href:v+"66"},description:"Extraction can not complete: Cannot read properties of null (reading 'getAttribute').",class:"fixed"},{link:{text:"Added #62",href:v+"62"},description:"Image editor (wallpaper generator).",class:"added"},{link:{text:"Fixed #60",href:v+"60"},description:'"Audible Library Extractor" text button is cut off in Audible library page.',class:"fixed"},{link:{text:"Fixed #56",href:v+"56"},description:"Wishlist extraction stops right when it's about to start.",class:"fixed"},{link:{text:"Fixed #54",href:v+"54"},description:"Partial library update doesn't merge old series data with new series data properly.",class:"fixed"},{link:{text:"Fixed #50",href:v+"50"},description:"Collections larger than 20 titles are not getting extracted properly.",class:"fixed"},{link:{text:"Fixed #49",href:v+"49"},description:"Sub pages don't show up in the the stand-alone gallery if you saved it with wishlist and any sub pages while excluding library.",class:"fixed"},{link:{text:"Fixed #48",href:v+"48"},description:"My books in the series list: links lead to empty pages inside the gallery (sometimes). Related to sub page source.",class:"fixed"},{link:{text:"Improved #47",href:v+"47"},description:"Merged the library data update button with the full extraction button. Now wishlist has a partial extraction too!",class:"improved"},{link:{text:"Fixed #46",href:v+"46"},description:"After opening a link to the gallery on a page with book details open, the next chunk of books would not load when scrolling far enough down.",class:"fixed"}]},{version:"v.0.2.6",highlights:"If you want to filter wishlist by Plus Catalog titles, you'll have to extract the <strong>wishlist</strong> again. The 'My books in the series' list can now show all books in the series, but this too requires a full extraction of the <strong>library</strong>. <br><br>Performance improvement <a href='https://github.com/joonaspaakko/audible-library-extractor/issues/41'>#41</a> changes the way the books are loaded in: they are loaded in chunks as you scroll down. This unfortunately makes it so you can't just jump to the beginning of your library at the bottom like you could before. If you must, you can get around this: in the address bar you should see a url parameter like this '?y=347'. The number keeps track of how far you're scrolled. Change that to and obnoxiously high number, like '?y=9999999' and press enter or refresh the page and it will load the entire library at once.",changes:[{link:{text:"New documentation",href:"https://joonaspaakko.gitbook.io/audible-library-extractor/"},description:'<a href="https://joonaspaakko.gitbook.io/audible-library-extractor/" target="_blank" rel="noopener noreferrer">https://joonaspaakko.gitbook.io/audible-library-extractor/</a>',highlight:!0,class:"info"},{link:{text:"Improved #25",href:v+"25"},description:"Improved filters with range sliders and you can enable multiple filters at the same time",highlight:!0,class:"improved"},{link:{text:"Added #30",href:v+"30"},description:"Stand-alone gallery save options that allow you to exclude pages",highlight:!0,class:"added"},{link:{text:"Added #26",href:v+"26"},description:"CSV export (Importable: goodreads, googlesheets, excel, etc...)",highlight:!0,class:"added"},{link:{text:"Fixed #35",href:v+"35"},description:"Firefox: ISBN+Wishlist extraction stops the entire extraction process",highlight:!0,class:"fixed"},{link:{text:"Added #38",href:v+"38"},description:"Easier way to get back to the gallery (and Audible library) using the extension icon context menu",highlight:!0,class:"added"},{link:{text:"Improved #41",href:v+"41"},description:"Improved gallery performance, especially on slightly older mobile devices.",highlight:!0,class:"improved"},{link:{text:"Fixed #44",href:v+"44"},description:"Certain links to Audible not working due to missing encoding",class:"fixed"},{link:{text:"Fixed #43",href:v+"43"},description:"Wishlist series hyperlink doesn't lead anywhere",class:"fixed"},{link:{text:"Fixed #42",href:v+"42"},description:"Child category heading shows up in parent category page",class:"fixed"},{link:{text:"Fixed #40",href:v+"40"},description:"Missing cover images causing various issues in the gallery (mostly affects long time Audible users)",class:"fixed"},{link:{text:"Fixed #37",href:v+"37"},description:"Extension icon active state (color icon) is triggering whenever",class:"fixed"},{link:{text:"Fixed #36",href:v+"36"},description:"Release date sorter not working on mobile (ios)",class:"fixed"},{link:{text:"Fixed #34",href:v+"34"},description:"Wishlist extraction stops and halts the whole extraction part 2",class:"fixed"},{link:{text:"Fixed #33",href:v+"33"},description:"Book details open in the wrong position breaking the grid at certain browser widths",class:"fixed"},{link:{text:"Fixed #31",href:v+"31"},description:"Sorting is taken over by search order If you have an active search and then change filters or search scope",class:"fixed"}]},{version:"v.0.2.5",changes:[{link:{text:"Fixed #28",href:v+"28"},description:"Series/sub page fails to show the right content",class:"fixed"},{link:{text:"Fixed #27",href:v+"27"},description:"The Great Courses (books) omitted",class:"fixed"},{link:{text:"Fixed #24",href:v+"24"},description:"Search overrides sorting URL parameter on page load",class:"fixed"},{link:{text:"Fixed #23",href:v+"23"},description:"Wishlist scraping errored out due to fetching second lvl domain names like \u201C.co.uk\u201D wrong",class:"fixed"},{link:{text:"Fixed #22",href:v+"22"},description:"Categories page empty (sometimes)",class:"fixed"},{link:{text:"Fixed #21",href:v+"21"},description:"View mode button showing up on pages it shouldn\u2019t",class:"fixed"},{link:{text:"Fixed #20",href:v+"20"},description:"Filter and sorter menu disappearing behing the bottom mobile nav",class:"fixed"},{link:{text:"Fixed #19",href:v+"19"},description:"Partial library scan breaking series",class:"fixed"}]},{version:"v.0.2.4",changes:[{description:"First public beta version"}]}]}}};const gt={mixins:[dt],data:function(){return{}},methods:{getChangelog:function(){let e="";return _.each(this.changeLog,function(s){e+='<strong style="display: inline-block; width: 100%; font-size: 16px;">'+s.version+"</strong>",e+=s.highlights?'<div style="padding: 6px; margin: 6px 0 7px; color: rgb(128 93 54); background: rgb(246, 153, 50, .06); border: 1px solid rgb(246, 153, 50, .2);">'+s.highlights+"</div>":"",e+='<ul class="ale-changelog-list" style="display: inline-block; width: 100%; box-sizing: border-box;">',_.each(s.changes,function(i){if(i.divider)e+='<li style="height: 0px; border: 1px dashed #f1f1f1; margin: 5px 0; width: 100%;"></li>';else{let o;i.link&&(o=i.highlight?"<strong>"+i.link.text+"</strong>":i.link.text),e+='<li class="'+(i.class||"")+'">'+(i.link?'<a target="_blank" rel="noopener noreferrer" href="'+i.link.href+'">'+o+"</a>: ":"")+(i.description||"")+"</li>"}}),e+="</ul>",e+="<br><br>"}),'<div style="text-align: left; max-height: 350px; overflow: scroll; padding: 20px;">'+e+"</div>"}}},ft=e=>(Z("data-v-01506283"),e=e(),G(),e),pt={id:"changelog"},ht=["content"],mt=ft(()=>g("span",null,"Changelog",-1));function bt(e,t,s,i,o,n){const a=ut,r=E("tippy");return m(),x("div",pt,[A((m(),x("button",{class:"button is-small is-text settings-btn",content:n.getChangelog()},[L(a,{class:"icon"}),mt],8,ht)),[[r,{allowHTML:!0,trigger:"click",interactive:!0}]])])}var _t=F(gt,[["render",bt],["__scopeId","data-v-01506283"]]);const yt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},xt=g("path",{fill:"currentColor",d:"M10 6v2H5v11h11v-5h2v6a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h6zm11-3v8h-2V6.413l-7.793 7.794l-1.414-1.414L17.585 5H13V3h8z"},null,-1),vt=[xt];function kt(e,t){return m(),x("svg",yt,vt)}var St={name:"ri-external-link-line",render:kt};const wt={viewBox:"0 0 256 256",width:"1.2em",height:"1.2em"},$t=g("path",{fill:"currentColor",d:"M128 20a108 108 0 1 0 108 108A108.1 108.1 0 0 0 128 20Zm0 192a84 84 0 1 1 84-84a84.1 84.1 0 0 1-84 84Zm48.5-92.5a12 12 0 0 1 0 17l-34 33.9a12 12 0 0 1-16.9 0a11.9 11.9 0 0 1 0-16.9L139 140H88a12 12 0 0 1 0-24h51l-13.4-13.5a12 12 0 0 1 16.9-16.9Z"},null,-1),Dt=[$t];function Pt(e,t){return m(),x("svg",wt,Dt)}var Ct={name:"ph-arrow-circle-right-bold",render:Pt};const qt={mixins:[Y],data:function(){const e=this,t=this.$store.state;return{store:this.$store.state,exportRawDataDisabled:!1,actions:[{key:"unselect all"},{key:"select all"},{key:"reset new books",disabled:function(){return!t.storageHasData.books},tippy:'<strong>Removes the status &#34;new&#34; from all extracted books.</strong> <br><br>During a partial library or wishlist extraction newly added books are marked and you can filter and sort based on that status in the gallery. <br><br><div style="color: #f14668;">The new status is only ever reset automatically when you clear library data or press this button.</div>'},{key:"export raw data",disabled:function(){return!e.rawDataExport}},{key:"import raw data",inputEvent:!0},{key:"remove all extracted data",extraClasses:"delete-btn"}]}},computed:{rawDataExport(){return!this.exportRawDataDisabled&&this.$store.getters.mainDataExists}},methods:{clickEvent(e,t){const s=_.camelCase(e.key);this[s](t)},unselectAll:function(){const e=this;_.each(this.$store.getters.settings_mainSteps,function(t,s){e.$store.commit("updateSetting",{item:t,obj:{value:!1,disabled:!1}})}),this.$store.commit("update",{key:"extractionButtonDisabled",value:!0})},selectAll:function(){const e=this;_.each(this.$store.getters.settings_mainSteps,function(t){e.$store.commit("updateSetting",{item:t,obj:{value:!0,disabled:t.name==="books"}})}),this.$store.commit("update",{key:"extractionButtonDisabled",value:!1})},resetNewBooks:function(){if(window.confirm("Are you sure you want to clear new book status?")){let t=this,s=function(){t.loading=!1,t.$toast.error({duration:4e3,message:'Failed to remove "new" status from books',type:"is-danger",position:"is-top",closable:!1})};chrome.storage.local.get(null).then(i=>{_.each(_.range(0,i["books-chunk-length"]),function(o){let n=i["books-chunk-"+o];_.each(n,function(a){a.isNew&&delete a.isNew})}),_.each(_.range(0,i["wishlist-chunk-length"]),function(o){let n=i["wishlist-chunk-"+o];_.each(n,function(a){a.isNew&&delete a.isNew})}),chrome.storage.local.clear().then(()=>{chrome.storage.local.set(i).then(()=>{t.$toast.success('All "new" books succesfully reset',t.store.toastOpts)}).catch(s)}).catch(s)}).catch(s)}},exportRawData:function(){let e=this;e.exportRawDataDisabled=!0,chrome.storage.local.get(null).then(t=>{t.chunks&&e.glueFriesBackTogether(t),delete t.imageEditorPageTitle,delete t.imageEditorPageSubTitle,delete t.imageEditorTimeCode,delete t.imageEditorChunksLength,delete t.imageEditorChunks,ce.exports.saveAs(new Blob([JSON.stringify(t)],{type:"application/json;charset=utf-8"}),"Audible Library Extractor Data.json"),e.exportRawDataDisabled=!1,e.$toast.success("Data exported succesfully!",e.store.toastOpts)}).catch(function(t){e.exportRawDataDisabled=!1,e.$toast.error("Data export failed. Reload the page and try again.",e.store.toastOpts)})},importRawData:function(e){let t=this,s=e.target.files;if(s&&(s=s[0]),e.target.value=null,s){t.loading=!0;let i=function(n){t.loading=!1,t.$toast.error("Data import failed: "+n,t.store.toastOpts)},o=new FileReader;o.onload=function(n){let a=JSON.parse(n.target.result);t.makeFrenchFries(a),chrome.storage.local.clear().then(()=>{chrome.storage.local.set(a).then(function(){t.$toast.success("Data imported succesfully!",t.store.toastOpts),t.loading=!1,t.$dataChecker(a)}).catch(i)}).catch(i)},o.onerror=i,o.readAsText(s)}},removeAllExtractedData:function(){let e=this;if(window.confirm("Are you sure you want to remove all extracted data?")){let s=function(i){e.loading=!1,e.$toast.error("Data clear failed: "+i,e.store.toastOpts)};chrome.storage.local.clear().then(function(){chrome.storage.local.get(null).then(i=>{e.$dataChecker(i),e.$toast.success("Data removed succesfully",e.store.toastOpts)}).catch(s)}).catch(s)}}}},At={class:"description"},Lt={class:"linky-links"},Mt=["onClick","content","disabled"],Nt=["onChange"];function It(e,t,s,i,o,n){const a=E("tippy");return m(),x("div",At,[g("div",Lt,[g("div",null,[(m(!0),x(ie,null,ne(e.actions,r=>A((m(),x("button",{key:r.key,class:O(["button is-small",r.extraClasses]),onClick:l=>r.inputEvent?null:n.clickEvent(r,l),content:r.tippy,disabled:r.disabled&&r.disabled()},[g("label",null,[C(M(r.key)+" ",1),r.inputEvent?(m(),x("input",{key:0,accept:".json",type:"file",onChange:l=>n.clickEvent(r,l),style:{display:"none"}},null,40,Nt)):U("",!0)])],10,Mt)),[[a,{maxWidth:400}]])),128))])])])}var Ot=F(qt,[["render",It],["__scopeId","data-v-388dacb2"]]);const Tt={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"},Ft=g("path",{d:"M405.333 106.667v298.666H106.667V106.667h298.666m0-42.667H106.667C83.198 64 64 83.198 64 106.667v298.666C64 428.802 83.198 448 106.667 448h298.666C428.802 448 448 428.802 448 405.333V106.667C448 83.198 428.802 64 405.333 64z",fill:"currentColor"},null,-1),zt=[Ft];function Bt(e,t){return m(),x("svg",Tt,zt)}var Ut={name:"ion-android-checkbox-outline-blank",render:Bt};const Ht={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Rt=g("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[g("path",{d:"m9 11l3 3l8-8"}),g("path",{d:"M20 12v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h9"})],-1),Et=[Rt];function jt(e,t){return m(),x("svg",Ht,Et)}var Wt={name:"tabler-checkbox",render:jt};const Vt={viewBox:"0 0 16 16",width:"1.2em",height:"1.2em"},Zt=g("path",{fill:"currentColor",d:"M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1l-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"},null,-1),Gt=[Zt];function Jt(e,t){return m(),x("svg",Vt,Gt)}var Qt={name:"bi-trash3",render:Jt};const Yt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Xt=g("path",{fill:"currentColor",d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10s10-4.47 10-10S17.53 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8s8 3.58 8 8s-3.58 8-8 8z"},null,-1),Kt=[Xt];function es(e,t){return m(),x("svg",Yt,Kt)}var ts={name:"ic-outline-circle",render:es};const ss={viewBox:"0 0 20 20",width:"1.2em",height:"1.2em"},is=g("path",{fill:"currentColor",d:"m0 11l2-2l5 5L18 3l2 2L7 18z"},null,-1),ns=[is];function rs(e,t){return m(),x("svg",ss,ns)}var os={name:"zondicons-checkmark",render:rs};const as={props:["index","settings","setting"],data:function(){return{store:this.$store.state}},computed:{settingHasData(){return _.get(this.$store.state.storageHasData,this.setting.name)},settingDisabled(){return this.setting.disabled===!1?null:!0}},methods:{settingChanged:function(){const e=this.setting,t=!e.value,s=this.$store.getters.settings_mainSteps,i=[];if(i.push({item:e,obj:{value:t}}),e.parent){const o=_.find(s,{name:e.parent}),n=_.find(s,function(r){return r.parent===e.parent&&r.value&&r.name!==e.name}),a={disabled:!!(t||n)};a.disabled&&(a.value=!0),i.push({item:o,obj:a})}this.$store.commit("updateSetting",i)},deleteChunkData:function(e,t){let s=this;if(s.loading=!0,!window.confirm('Delete "'+this.setting.label+'" data?'))return;let o=e.join(", ").replace("books","library"),n="Failed to remove data for: <strong>"+o+"</strong>",a="Successfully removed data for: <strong>"+o+"</strong>",r=function(l){s.loading=!1,s.$toast.error(n+" ("+l+")",s.toastOpts)};chrome.storage.local.get(null).then(l=>{_.each(e,function(d){let c;d==="isbn"&&(d="books",c="isbn"),_.each(_.range(0,l[d+"-chunk-length"]),function(f){c==="isbn"?_.each(l["books-chunk-"+f],function(u){u.isbns&&delete u.isbns}):delete l[d+"-chunk-"+f]}),(d!=="books"||d==="books"&&c!=="isbn")&&(delete l[d+"-chunk-length"],_.remove(l.chunks,function(f){return f===d})),d==="books"&&_.remove(l.chunks,function(f){return f==="isbn"}),delete l.version[d==="books"?"library":d],l.config&&l.config.steps&&delete l.config.steps}),l.chunks.length<1&&delete l.chunks,chrome.storage.local.clear().then(()=>{chrome.storage.local.set(l).then(()=>{t&&t(l),s.$toast.success(a,s.store.toastOpts),s.$dataChecker(l)}).catch(r)}).catch(r)}).catch(r)}}},ls=["content"],cs={class:"control pointer"},us=["disabled"],ds={class:"button"},gs={class:"step-number"},fs={class:"control pointer"},ps=["disabled"],hs=["content"],ms=["disabled"],bs={class:"checkbox"},_s=["content"],ys={class:"icon is-small"};function xs(e,t,s,i,o,n){const a=os,r=ts,l=Qt,d=E("tippy");return A((m(),x("div",{class:O(["field has-addons",{disabled:s.setting.disabled}]),style:{margin:"5px"},content:s.setting.cannotAccessTippy},[g("p",cs,[g("button",{class:"setting-numbers-wrapper button is-small",onClick:t[0]||(t[0]=c=>n.settingChanged()),disabled:n.settingDisabled},[g("div",ds,[g("span",gs,M(s.index+1),1)])],8,us)]),g("p",fs,[g("button",{class:"checbox-wrapper button is-small",onClick:t[1]||(t[1]=c=>n.settingChanged()),disabled:n.settingDisabled},[g("div",{class:O(["button",[s.setting.value?s.setting.type:null]])},[s.setting.value?(m(),T(a,{key:0})):(m(),T(r,{key:1,style:{opacity:".7"}}))],2)],8,ps)]),A((m(),x("p",{class:"control full-width pointer",content:s.setting.tippy},[g("button",{class:"button checkbox-btn is-small",disabled:n.settingDisabled,onClick:t[2]||(t[2]=c=>n.settingChanged())},[g("label",bs,M(s.setting.label),1)],8,ms)],8,hs)),[[d]]),n.settingHasData?A((m(),x("p",{key:0,class:"control delete-btn",content:"Remove previously extracted data."+(s.setting.trashTippy?"<br>"+s.setting.trashTippy:"")},[g("button",{class:"button is-small remove-individual-sections-icon",onClick:t[3]||(t[3]=c=>n.deleteChunkData(s.setting.deleteChunks||[s.setting.name]))},[g("span",ys,[L(l)])])],8,_s)),[[d]]):U("",!0)],10,ls)),[[d,{allowHTML:!0,interactive:!0}]])}var vs=F(as,[["render",xs],["__scopeId","data-v-f1485078"]]);const ks={data:function(){return{store:this.$store.state}},computed:{saveStandaloneAfter:function(){return _.find(this.store.extractSettings,{name:"saveStandaloneAfter"})}},methods:{checkBrowser:function(){this.isFirefox=chrome.runtime.getURL("").startsWith("moz-extension://"),this.isChrome=chrome.runtime.getURL("").startsWith("chrome-extension://")}}},Ss=e=>(Z("data-v-b2441784"),e=e(),G(),e),ws={class:"settings-wrapper box panel",animation:"slide"},$s={class:"extract-settings"},Ds=Ss(()=>g("div",{class:"settings-heading"},[g("span",{class:"title is-4"},"Extraction Settings")],-1)),Ps={class:"row is-0 setting-checkboxes"},Cs={class:"checkbox is-small is-dark no-selection"},qs={style:{"vertical-align":"middle","padding-right":"5px"}};function As(e,t,s,i,o,n){const a=vs,r=Wt,l=Ut,d=Ot;return m(),x("div",ws,[g("div",$s,[Ds,g("div",Ps,[(m(!0),x(ie,null,ne(e.$store.getters.settings_mainSteps,(c,f)=>(m(),x("div",{key:c.name,class:O({checked:c.value,unchecked:!c.value})},[L(a,{class:O({"partial-extraction":e.store.storageHasData[c.name]}),index:f,settings:e.$store.getters.settings_mainSteps,setting:c},null,8,["class","index","settings","setting"])],2))),128))]),g("label",Cs,[A(g("input",{style:{width:"0px",height:"0px",position:"absolute",top:"-1px",left:"-1px",overflow:"hidden",opacity:"0"},type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=c=>n.saveStandaloneAfter.value=c)},null,512),[[ue,n.saveStandaloneAfter.value]]),g("span",qs,[n.saveStandaloneAfter.value?(m(),T(r,{key:0})):(m(),T(l,{key:1}))]),g("span",null,M(n.saveStandaloneAfter.label),1)]),L(d)])])}var Ls=F(ks,[["render",As],["__scopeId","data-v-b2441784"]]);const Ms={name:"menuScreen",props:["domainExtension","wishlistUrl"],mixins:[Y],data(){return{store:this.$store.state,hasData:null,hasConfig:null,settingsOpen:!0,loading:!0,isFirefox:!1,isChrome:!1,releaseURL:"",showDeleteBtns:!1,showPartialExtraction:!1,exportRawDataDisabled:!1,cannotAccessWishlist:!1}},computed:{dataVersionMismatch:function(){return[]}},created:function(){console.log("$store.getters.settings_mainSteps",this.$store.getters.settings_mainSteps),this.hasData=this.$store.state.storageHasData,this.hasConfig=this.$store.state.storageConfig,this.checkBrowser(),this.makeReleaseURLs()},mounted:function(){this.$nextTick(function(){setTimeout(()=>{this.loading=!1},300)})},methods:{checkAccess:function(e){e=e||{},axios.get(e.to).then(function(){e.success&&e.success()}).catch(function(){e.failed&&e.failed()}).then(function(){e.finally&&e.finally()})},checkBrowser:function(){this.isFirefox=chrome.runtime.getURL("").startsWith("moz-extension://"),this.isChrome=chrome.runtime.getURL("").startsWith("chrome-extension://")},makeReleaseURLs:function(){this.releaseURL=this.isFirefox?"https://chrome.google.com/webstore/detail/audible-library-extractor/deifcolkciolkllaikijldnjeloeaall":"https://addons.mozilla.org/firefox/addon/audible-library-extractor/"},extract:function(){let e=this;this.$store.getters.setting("wishlist").value?(this.$store.commit("update",{key:"extractBtnDisabled",value:!0}),this.$store.commit("update",{key:"extractionButtonDisabled",value:!0}),e.checkAccess({to:e.wishlistUrl,success:function(t){e.takeNextStep("extract")},failed:function(){e.cannotAccessWishlist=!0},finally:function(){e.$store.commit("update",{key:"extractBtnDisabled",value:!1})}})):e.takeNextStep("extract")},takeNextStep:function(e,t){t||(t={steps:_.map(_.filter(this.store.extractSettings,function(s){return s.value&&!s.extra}),function(s){return{name:s.name,value:s.value}})}),t.extraSettings=_.map(_.filter(this.store.extractSettings,"extra"),function(s){return{name:s.name,value:s.value,deactivated:!1}}),this.$compEmitter.emit("start-extraction",{step:e,config:t})}}},I=e=>(Z("data-v-13289dfe"),e=e(),G(),e),Ns={key:0,class:"message is-info"},Is={class:"message-body"},Os=C("Previously extracted data detected: "),Ts={style:{color:"#f7991c"}},Fs=C("a faster "),zs={content:"<div style='display: block; text-align: left;'><ol style='margin-left: 15px;'><li>Updates stored data that is likely to change</li><li>Does a full extract on newly added books</li><li>Clears data of removed books</li></ol><span style='display: inline-block; margin-top: 6px; color: #157df0;'>In the case of ISBN extraction, books that already have ISBNs are ignored. A large amount of books (+100) without the numbers will still take quite a while to extract.</span></div>",style:{cursor:"default","text-decoration":"underline"}},Bs=C("partial extraction"),Us=[Bs],Hs=C(" is used"),Rs=C(),Es=I(()=>g("br",null,null,-1)),js=C(" If you need to do a "),Ws={content:"The data structure may change from version to version, in which case a full extraction is needed or at least preferred. <br><br>You need to remove extracted data in order to do a full extraction.",style:{cursor:"default","text-decoration":"underline"}},Vs=C("full extraction"),Zs=[Vs],Gs=C(", you can remove stored data using "),Js=C(". "),Qs={class:"extract-wrapper"},Ys={key:0},Xs={class:"message is-warning"},Ks={class:"message-body"},ei=C(" Try to open your "),ti=["href"],si=C(" and login when asked. "),ii=I(()=>g("br",null,null,-1)),ni=C(" After that try to redo the extraction. "),ri=I(()=>g("strong",null,"The link will open in a new tab!",-1)),oi={key:1},ai=I(()=>g("div",{class:"progress-wrapper"},[g("progress",{class:"progress is-warning is-large",max:"100",style:{"min-width":"288px"}},"75%"),g("small",{style:{"font-size":"12px"}},"Checking for wishlist access...")],-1)),li=[ai],ci={key:2,class:"field has-addons extract-btn"},ui={class:"control"},di={class:"control"},gi={class:"field has-addons other-btns"},fi={class:"button control is-small",tag:"a",href:"https://joonaspaakko.gitbook.io/audible-library-extractor/",target:"_blank"},pi=C(" Documentation "),hi=["disabled"],mi=C(" Open gallery "),bi={id:"footer",class:"is-small has-text-grey-light"},_i=C(" Project source files in "),yi=I(()=>g("a",{href:"https://github.com/joonaspaakko/audible-library-extractor"},"Github",-1)),xi=C(". "),vi=I(()=>g("br",null,null,-1)),ki=C(" Post issues, questions, and suggestions at: "),Si=I(()=>g("a",{href:"https://github.com/joonaspaakko/audible-library-extractor/issues"},"Github issues",-1)),wi=C(". "),$i=I(()=>g("br",null,null,-1)),Di=I(()=>g("br",null,null,-1)),Pi={target:"_blank",rel:"noopener noreferrer",href:"https://github.com/joonaspaakko/audible-library-extractor/releases/latest",content:"It may take a few days for a new release to propagate from Github to Firefox and Chrome web store."},Ci=I(()=>g("img",{src:"https://img.shields.io/github/v/release/joonaspaakko/audible-library-extractor?include_prereleases&label=latest%20release (Github)&color=6e41bf",alt:""},null,-1)),qi=[Ci],Ai=de('<a target="_blank" rel="noopener noreferrer" href="https://github.com/joonaspaakko/audible-library-extractor/releases/latest" data-v-13289dfe><img src="https://img.shields.io/github/release-date/joonaspaakko/audible-library-extractor?label=latest%20release&amp;color=6e41bf" alt="" data-v-13289dfe></a><a target="_blank" rel="noopener noreferrer" href="https://github.com/joonaspaakko/audible-library-extractor/labels/bug" data-v-13289dfe><img src="https://img.shields.io/github/issues/joonaspaakko/audible-library-extractor/bug?label=known bugs&amp;color=6e41bf" alt="" data-v-13289dfe></a><br data-v-13289dfe><a target="_blank" rel="noopener noreferrer" href="https://chrome.google.com/webstore/detail/audible-library-extractor/deifcolkciolkllaikijldnjeloeaall" data-v-13289dfe><img src="https://img.shields.io/chrome-web-store/v/deifcolkciolkllaikijldnjeloeaall?color=2acb41&amp;label=latest%20release (Chrome)" alt="" data-v-13289dfe></a><a target="_blank" rel="noopener noreferrer" href="https://addons.mozilla.org/en-US/firefox/addon/audible-library-extractor/" data-v-13289dfe><img src="https://img.shields.io/amo/v/audible-library-extractor?label=latest%20release (Firefox)" alt="" data-v-13289dfe></a>',5),Li={style:{"margin-top":"10px"}},Mi={style:{border:"1px dashed #e1e1e1",padding:"10px 15px",display:"inline-block"}},Ni=C(" You're currently using "),Ii=C(". "),Oi={key:1,class:"extraction-loading"};function Ti(e,t,s,i,o,n){const a=Ls,r=Ct,l=St,d=_t,c=rt,f=E("tippy");return m(),x("div",null,[o.loading?(m(),x("div",Oi,[L(c,{class:"spin"})])):(m(),x("div",{key:0,id:"ale-menu-screen",class:O({"show-delete-btns":o.showDeleteBtns,"show-partial-extraction":o.showPartialExtraction})},[L(a),e.$store.getters.partialDataSettings_any?(m(),x("article",Ns,[g("div",Is,[g("strong",null,[Os,g("span",Ts,[Fs,A((m(),x("span",zs,Us)),[[f,{allowHTML:!0}]]),Hs]),Rs,g("span",{class:"init-show-partial-extraction",style:{color:"#f7991c"},onMouseover:t[0]||(t[0]=u=>o.showPartialExtraction=!0),onMouseleave:t[1]||(t[1]=u=>o.showPartialExtraction=!1)},"where applicable.",32)]),Es,js,A((m(),x("span",Ws,Zs)),[[f,{maxWidth:310}]]),Gs,g("span",{class:"init-show-detele-btns",onMouseover:t[2]||(t[2]=u=>o.showDeleteBtns=!0),onMouseleave:t[3]||(t[3]=u=>o.showDeleteBtns=!1)},"these buttons",32),Js])])):U("",!0),g("div",null,[g("div",Qs,[o.cannotAccessWishlist?(m(),x("div",Ys,[g("article",Xs,[g("div",Ks,[ei,g("a",{target:"_blank",rel:"noopener noreferrer",href:"https://audible"+s.domainExtension+"/wishlist"},"audible"+M(s.domainExtension)+"/wishlist",9,ti),si,ii,ni,ri])])])):o.store.extractBtnDisabled?(m(),x("div",oi,li)):A((m(),x("div",ci,[g("p",ui,[g("button",{class:"button is-info extract is-large",onClick:t[4]||(t[4]=(...u)=>n.extract&&n.extract(...u)),expanded:""}," Extract selected items ")]),g("p",di,[g("button",{class:"button is-dark is-large",onClick:t[5]||(t[5]=(...u)=>n.extract&&n.extract(...u))},[L(r)])])],512)),[[se,!o.store.extractionButtonDisabled&&!o.loading]]),g("div",gi,[g("a",fi,[pi,L(l)]),g("a",{class:"button control is-small",disabled:e.$store.getters.mainDataExists?null:!0,onClick:t[6]||(t[6]=u=>n.takeNextStep("output"))},[mi,L(l)],8,hi)])])]),L(d),g("div",bi,[_i,yi,xi,vi,ki,Si,wi,$i,Di,A((m(),x("a",Pi,qi)),[[f]]),Ai,g("div",Li,[g("span",Mi,[Ni,g("strong",null,"version "+M(o.store.appVersion),1),Ii])])])],2))])}var Fi=F(Ms,[["render",Ti],["__scopeId","data-v-13289dfe"]]),zi={methods:{minutesToMilliseconds:function(e){return e*60*1e3},secondsToMilliseconds:function(e){return e*1e3},amapxios:function(e){const t=this,s=e.rateLimit||this.$store.state.axiosRateLimit,i=this.minutesToMilliseconds(1);let o=axios.create();o=Q(o,s);const n=a=>{let r=new Url(DOMPurify.sanitize(a));if(r.query.asin)return r.query.asin;{const l=r.path.split("/");return l[l.length-1]}};asyncMapLimit(e.requests,s.maxRequests,function(a,r){const l=e.config||{},d=a.requestUrl||a.url||a,c=a.requestId||a.asin||n(d),f=new AbortController;console.log("request",a),console.log("requestURL",d),console.log("requestId",c);const u=_.includes(t.$store.state.failedRequests,c);if(console.log("urlAlreadyFailed",u,JSON.parse(JSON.stringify(t.$store.state.failedRequests)),d),u){r(null,null);return}l.signal=f.signal,l.validateStatus=function(k){return k>=200&&k<400};let p=setTimeout(()=>{f.abort("Request took too long... ("+d+")")},i),y=null;o.get(d,l).then(function(k){try{e.step(k,function(h){y=h},a)}catch(h){console.log("%caxios caught an error (step)","background: #0082ab; color: #fff; padding: 2px 5px; border-radius: 8px;",h)}}).catch(function(k){const h=_.get(k,"response.status");console.log("4040 STATUS ",h==404),h==404&&t.$store.commit("pushToFailedRequests",c),console.log("%caxios caught an error (step)","background: #f41b1b; color: #fff; padding: 2px 5px; border-radius: 8px;",`

`,d,`

`,k),_.get(k,"message")==="canceled"&&t.$store.commit("pushToCanceledRequests",d);try{e.returnCatch&&e.step(_.get(k,"response",k),function(w){y=w},a,"processingError")}catch(w){console.log("%caxios caught an error (step)","background: #0082ab; color: #fff; padding: 2px 5px; border-radius: 8px;",w)}}).then(function(){clearTimeout(p),r(null,y)})},function(a,r){a?(console.log("%caxios caught an error (done)","background: #f79a33; color: #fff; padding: 2px 5px; border-radius: 8px;",a),e.done(null,!0)):(r=e.flatten?_.flatten(r):r,r=_.compact(r),e.done(r))})}}},Bi={methods:{scrapingPrep:function(e){const t=this;e=e||{};let s=new Url(DOMPurify.sanitize(e.url));if(_.includes(t.$store.state.failedRequests,s)){e.done(null);return}const o=axios.create(),n=Q(o,this.$store.state.axiosRateLimit);waterfall([function(a){s.query.ale=!0,s.query.bp_ua="yes";let r={};r.urlObj=s,e.skipFirstCall?t.getMaxPageSize(r,e,e.response,a):n.get(s.toString()).then(function(l){t.getMaxPageSize(r,e,l,a)}).catch(function(l){_.get(l,"response.status")==404&&t.$store.commit("pushToFailedRequests",requestURL),a(!0,null)})},function(a,r){n.get(a.urlObj.toString()).then(function(l){const c=$($.parseHTML(l.data)).find("div.adbl-main").find(".pagingElements"),f=c.length>0?parseFloat(DOMPurify.sanitize(c.find(".pageNumberElement:last").text())):1;a.pageNumbers=_.range(1,f+1),a.pageSize=a.urlObj.query.pageSize||null,r(null,a)})}],function(a,r){e.done(r)})},getMaxPageSize:function(e,t,s,i){const o=$($.parseHTML(s.data)).find("div.adbl-main"),n=o.find('select[name="pageSize"]'),a=n.length>0?DOMPurify.sanitize(n.find("option:last").val()):null;e.urlObj.query.pageSize=t.maxSize||e.urlObj.query.pageSize||a,t.returnResponse&&(e.response=s),!o.find(".pagingElements").length||!a||a<50||t.returnAfterFirstCall?(e.pageNumbers=[1],e.pageSize=e.urlObj.query.pageSize,i(!0,e)):i(null,e)},getPageNumbers:function(e){const s=$($.parseHTML(e.data)).find("div.adbl-main").find(".pagingElements"),i=s.length>0?parseFloat(DOMPurify.sanitize(s.find(".pageNumberElement:last").text())):1;return _.range(1,i+1)}}},Ui={methods:{getDataFromCarousel:function(e,t,s,i){const o=t.querySelector("#adbl-web-carousel-c"+i);if(o){const n=[],a=o.querySelectorAll(".carousel-product");_.each(a,function(r){const l={};let d=r.querySelector('[id^="product-carousel-image"]');if(d&&(d=d.getAttribute("src")||d.getAttribute("data-lazy")),!d)return!1;let c=d.match(/\/images\/I\/(.*)._SL/);if(c&&c[1]&&(c=""+DOMPurify.sanitize(c[1])),!c)return!1;l.cover=c;let f=r.querySelector("[data-asin]");if(f&&(f=f.getAttribute("data-asin")),f&&(f=""+DOMPurify.sanitize(f)),!f)return!1;l.asin=f;const u=r.querySelector("[id^=product-list-flyout] ul");let p,y;if(u&&(p=u.querySelectorAll("li:not(.bc-size-base)"),p)){if(y=u.querySelector("li.bc-size-base:nth-child(2)"),y){let k=y.querySelector(".bc-pub-offscreen");k&&k.remove()}y&&(y=y.textContent),y&&(y=DOMPurify.sanitize(y.trim())),y&&(l.subHeading=y)}p&&_.each(p,function(k,h){let w=k.querySelector(".bc-pub-offscreen");w&&w.remove();let b=k.textContent;if(b&&(b=DOMPurify.sanitize(b.trimAll())),b&&!k.querySelector("h2")&&(b=b.trimToColon()),!b)return!1;var S=h+1;switch(S){case 1:l.title=b;break;case 2:l.authors=b;break;case 3:l.narrators=b;break;case 4:l.length=b;break}}),n.push(l)}),n.length>0&&(e[s]=n)}}}},Hi={methods:{getDataFromLibraryPages:function(e,t){const s=this;_.find(e.config.steps,{name:"books"})?(this.$store.commit("update",[{key:"bigStep.title",value:"Library"},{key:"bigStep.step",add:1},{key:"subStep.step",add:1},{key:"subStep.max",value:5},{key:"progress.step",value:0},{key:"progress.max",value:0},{key:"progress.text",value:this.$store.state.storageHasData.books?"Updating old books and adding new books...":"Scanning library for books..."}]),s.scrapingPrep({url:s.libraryUrl,maxSize:20,done:function(i){const o=i.urlObj.toString();s.amapxios({requests:_.map(i.pageNumbers,function(n){return{requestUrl:o+"&page="+n,requestId:"library-page-"+n}}),step:function(n,a){s.processLibraryPage(n,e,a)},flatten:!0,done:function(n){s.$nextTick(function(){if(e.books=n,e.books&&e.books.length){const a=_.xorBy(e.books,n,"asin");if(a.length>0){let r=_.filter(a,function(l){return!l.isNewThisRound});r.length>0&&(s.removeFromSeries(e.series,r),s.removeFromCollections(e.collections,r))}if(e.wishlist&&e.wishlist.length>0){let r=_.filter(e.books,"isNewThisRound");r.length>0&&(r=_.map(r,"asin"),_.remove(e.wishlist,function(l){return _.includes(r,l.asin)}))}}e.config.getStorePages="books",s.$nextTick(function(){t(null,e)})})}})}})):(s.$store.commit("resetProgress"),t(null,e))},processLibraryPage:function(e,t,s){let i=this;const o=$($.parseHTML(e.data)).find("div.adbl-main")[0];e.data=null;const n=[],a=o.querySelectorAll("#adbl-library-content-main > .adbl-library-content-row");each(a,function(r){const l={is:{product:r.querySelector('[name="contentType"][value="Product"]'),performance:r.querySelector('[name="contentType"][value="Performance"]'),lecture:r.querySelector('[name="contentType"][value="Lecture"]'),podcast:r.querySelector('[name="contentType"][value="Podcast"]')}};let d=r.querySelector("[data-asin]");d=d.getAttribute("data-asin"),d=DOMPurify.sanitize(d);const c=_.find(t.books,["asin",d]),f=i.$store.state.storageHasData.books&&!c||!i.$store.state.storageHasData.books;let u=i.$store.state.storageHasData.books&&c?c:{};c&&c.isbns&&(u.isbns=c.isbns);let p;if(l.is.podcast&&(p=r.querySelector(".adbl-episodes-link > a")),p||(p=r.querySelector(":scope > div > div > div > div > span > ul > li:nth-child(1) > a")),p){let P=new Url(window.location.origin+DOMPurify.sanitize(p.getAttribute("href")));P.clearQuery(),u.storePageRequestUrl=P.toString()}if(f){u.asin=d;const P=r.querySelector("a > img.bc-image-inset-border:first-of-type")||r.querySelector(":scope > div > div > div > a > img.bc-image-inset-border")||r.querySelector(":scope > div > div > div > img.bc-image-inset-border");if(P){let z=P.getAttribute("src");if(z=DOMPurify.sanitize(z),z.lastIndexOf("img-coverart-prod-unavailable")<0){let B=z.match(/\/images\/I\/(.*)._SL/);B=_.get(B,"[1]"),B&&(u.cover=B)}}u.title=DOMPurify.sanitize(r.querySelector(":scope > div > div > div > div > span > ul > li:nth-child(1)").textContent.trimAll()),u.authors=i.getArray(r.querySelectorAll(".authorLabel a")),u.narrators=i.getArray(r.querySelectorAll(".narratorLabel a")),u.series=i.getSeries(r.querySelector(".seriesLabel > span")),u.blurb=DOMPurify.sanitize(r.querySelector(".summaryLabel > span").textContent.trimAll()),r.querySelector('input[value="AudibleDiscovery"]')&&(u.fromPlusCatalog=!0)}r.querySelector(".adbl-library-inaccessible-button")?u.unavailable=!0:u.unavailable&&delete u.unavailable,u.downloaded=r.querySelector(".adbl-library-action > div:nth-child(4) > span")?!0:null,r.querySelector('[id^="remove-from-favorites-button"]:not(.bc-pub-hidden)')?u.favorite=!0:u.favorite&&delete u.favorite;const h=r.querySelector('[id^="time-remaining-display"] [role="progressbar"]'),w=!!r.querySelector('[id^="time-remaining-finished"]:not(.bc-pub-hidden)');let b=r.querySelector('[id^="time-remaining"]:not(.bc-pub-hidden)');b&&(b=DOMPurify.sanitize(b.textContent.trimAll())),h||w?u.progress=b:(u.length=b,u.progress=0);let S=r.querySelector('[id^="collectionIds-"]');if(S&&delete u.collectionIds,console.log("collectionIds-1",S),S&&(S=S.getAttribute("value")),S&&(S=S.replace(/^\[/,"").replace(/\]$/,"").trim()),S&&(S=S.split(", ")),console.log("collectionIds-2",S),S&&S.length>0){const P=["","__PENDING","__PURCHASE"];_.remove(S,function(q){return _.includes(P,q.trim())}),S.length>0&&(u.collectionIds=S)}let D=r.querySelector("div.bc-rating-stars.adbl-prod-rate-review-bar.adbl-prod-rate-review-bar-overall");if(D&&(D=D.getAttribute("data-star-count")),D>0&&(u.myRating=DOMPurify.sanitize(D)),u=_.omitBy(u,_.isNull),i.$store.state.storageHasData.books){let P=!c,q=c&&c.isNew;(P||q)&&(u.isNew=!0)}f&&(u.isNewThisRound=!0,i.$store.commit("update",{key:"progress.max",add:1})),n.push(u)}),i.$nextTick(function(){s(n)})}}},Ri={methods:{getDataFromStorePages:function(e,t){this.$store.commit("update",{key:"subStep.step",add:1});const s=this;let i=[];const o=e.config.getStorePages;e.config.getStorePages&&(i=this.prepStorePages(e,e.config.getStorePages),e.config.getStorePages=!1),i.length?(e.config.test||this.$store.commit("update",[{key:"progress.step",value:0},{key:"progress.bar",value:!0},{key:"progress.text",value:"Fetching additional data from store pages..."}]),console.log("requests 123",i),s.amapxios({requests:i,returnCatch:!0,step:function(a,r,l,d){_.get(l,"requestUrl")&&delete l.requestUrl,e.config.test||s.$store.commit("update",{key:"progress.text2",value:_.get(l,"title")}),a&&a.status>=200&&a.status<400?s.getStorePageData(a,l,e.config.test):l&&(l.storePageMissing=!0),e.config.test||s.$store.commit("update",{key:"progress.step",add:1}),r(l)},flatten:!0,done:n})):n();function n(){e.config.test||s.$store.commit("resetProgress"),o==="wishlist"&&s.$store.commit("update",[{key:"subStep.step",value:0},{key:"subStep.max",value:0}]),s.$nextTick(function(){t(null,e)})}},prepStorePages:function(e,t){let s=this;_.each(e[t],function(o){s.$store.state.storageHasData[t]&&!e.config.test?o.isNewThisRound&&(o.requestUrl=o.storePageRequestUrl):o.requestUrl=o.storePageRequestUrl;let n=new Url(o.requestUrl);n.query.ipRedirectOverride=!0,n.query.overrideBaseCountry=!0,o.requestUrl=n.toString(),delete o.storePageRequestUrl});let i=[];return s.$store.state.storageHasData[t]&&!e.config.test?i=_.filter(e[t],"isNewThisRound"):i=e[t]||[],i},getStorePageData:function(e,t,s){let i=this;var o=$($.parseHTML(e.data));const n=o.find("div.adbl-main")[0];let a=o.find("#bottom-0 > script:first")[0];a&&(a=JSON.parse(a.textContent));const r=a?a[0]:{};o=null,e.data=null,s||e.request.responseURL.lastIndexOf(t.asin)<0&&(t.storePageChanged=!0);const l=n&&n.querySelector("#sample-player-"+t.asin+" > button"),d=n&&n.querySelector("#adbl-buy-box-play-now-button");if(s||l||d){if(t.storePageMissing=!1,!t.cover){const b=n.querySelector("#center-1 > div > div > div > div.bc-col-responsive > div > div:nth-child(1) > img"),S=n.querySelector("#center-1 > div > div.bc-container > div > div:nth-child(1) > img");let D=b||S;if(D&&(D=D.getAttribute("src"),D=DOMPurify.sanitize(D),D.lastIndexOf("img-coverart-prod-unavailable")<0)){let P=D.match(/\/images\/I\/(.*)._SL/);P=_.get(P,"[1]"),P&&(t.cover=P)}}t.titleShort=DOMPurify.sanitize(r.name);const p=n.querySelector(".subtitle");p&&(t.subtitle=DOMPurify.sanitize(p.textContent.trimAll()));const y=n.querySelector(".ratingsLabel > a");y&&(t.ratings=parseFloat(DOMPurify.sanitize(y.textContent.match(/\d/g).join(""))));const k=n.querySelector(".ratingsLabel > span:last-of-type");k&&(t.rating=Number(DOMPurify.sanitize(k.textContent.trimAll()))),t.summary=DOMPurify.sanitize(r.description)||i.getSummary(n.querySelector(".productPublisherSummary > .bc-section > .bc-box:first-of-type")||n.querySelector("#center-1 > div.bc-container > div > div.bc-col-responsive.bc-col-6")),t.releaseDate=DOMPurify.sanitize(r.datePublished)?DOMPurify.sanitize(r.datePublished):i.fixDates(n.querySelector(".releaseDateLabel")),t.publishers=i.getArray(n.querySelectorAll(".publisherLabel > a"));const h=n.querySelector(".runtimeLabel");t.length=t.length||(h?i.shortenLength(h.textContent.trimToColon()):0),t.categories=i.getArray(n.querySelector(".categoriesLabel")?n.querySelectorAll(".categoriesLabel > a"):n.querySelectorAll(".bc-breadcrumb > a")),t.sample=s||!l?null:DOMPurify.sanitize(l.getAttribute("data-mp3")),t.language=r.inLanguage?DOMPurify.sanitize(_.startCase(r.inLanguage)):DOMPurify.sanitize(n.querySelector(".languageLabel").textContent.trimToColon()),t.format=DOMPurify.sanitize((n.querySelector(".format")||"").textContent.trimAll()),t.series||(t.series=i.getSeries(n.querySelector(".seriesLabel")));const w=n.querySelector(".ws4vLabel > a");if(w){const S=w.querySelector("img").getAttribute("alt");S.match(/Voice-enabled/)?t.whispersync="owned":S.match(/Voice-ready/)&&(t.whispersync="available")}var c=n.querySelector(".product-topic-tags");if(c){var f=[],u=n.querySelectorAll(".bc-chip-text");each(u,function(b){var S={},D=b.closest("a").getAttribute("href");D&&(D=DOMPurify.sanitize(D),D=new Url(D).path,D=D.split("/").pop(),S.url=DOMPurify.sanitize(D));var P=b.getAttribute("data-text");P&&(S.name=DOMPurify.sanitize(P),f.push(S))}),f.length>0&&(t.tags=f)}i.getDataFromCarousel(t,n,"peopleAlsoBought",5),i.getDataFromCarousel(t,n,"moreLikeThis",6),t=_.omitBy(t,_.isNull)}else t.storePageMissing=!0}}},Ei={methods:{getISBNsFromGoogleBooks:function(e,t){_.find(e.config.steps,{name:"isbn"})?(this.$store.commit("update",[{key:"bigStep.title",value:"International Standard Book Number (ISBN)"},{key:"bigStep.step",add:1},{key:"progress.text2",value:"(The matching process is relatively loose: beware of false matches)"},{key:"progress.text",value:"Fetching ISBNs from Google Books API..."},{key:"progress.step",value:0},{key:"progress.max",value:0},{key:"progress.bar",value:!0}]),ji(this,e,t)):(this.$store.commit("resetProgress"),t(null,e))}}};function ji(e,t,s){const i=[];let o=_.filter(t.books,function(r){return!r.isbns});_.each(o,function(r){if(r.title&&r.authors){const l=encodeURIComponent(r.title)+"+inauthor:"+encodeURIComponent(r.authors[0].name),d="";i.push({url:"https://www.googleapis.com/books/v1/volumes?"+d+"&maxResults=5&q="+l,asin:r.asin,title:r.title})}}),e.$store.commit("update",{key:"progress.max",add:i.length});const n=axios.create();axiosRetry(n,{retries:7,retryDelay:axiosRetry.exponentialDelay,retryCondition:function(r){return axiosRetry.isNetworkOrIdempotentRequestError(r)||r&&r.response&&r.response.status=="429"}});const a=Q(n,{maxRequests:6,perMilliseconds:1100});asyncMapLimit(i,18,function(r,l){a.get(r.url,{validateStatus:function(d){return d>=200&&d<400}}).then(function(d){const c=_.find(t.books,{asin:r.asin});if(d&&d.status>=200&&d.status<400&&d.data&&d.data.totalItems){let f=new ge(d.data.items,{keys:["volumeInfo.title"]});const u=_.map(f.search(c.titleShort),"item"),p=_.find(u,function(y){let k=!1;return _.each(y.volumeInfo.industryIdentifiers,function(h){(h.type==="ISBN_10"||h.type==="ISBN_13")&&(k=!0)}),k});if(p){let y=[];if(_.each(p.volumeInfo.industryIdentifiers,function(k){if(k.type==="ISBN_10"||k.type==="ISBN_13"){let h={type:DOMPurify.sanitize(k.type),identifier:DOMPurify.sanitize(k.identifier)};y.push(h)}}),y.length>0&&(c.isbns=y,_.get(p,"volumeInfo.imageLinks.smallThumbnail"))){const k=DOMPurify.sanitize(p.volumeInfo.imageLinks.smallThumbnail.replace("http://","https://"));e.$store.commit("update",{key:"progress.thumbnail",value:k})}}}c.isbns||console.log("%cCouldn't find ISBN(S): "+c.title,"background: #f41b1b; color: #fff; padding: 2px 5px; border-radius: 8px;",d),e.$store.commit("update",{key:"progress.step",add:1}),l(null)}).catch(d=>{console.log("%cCouldn't find ISBN(S): "+r.title,"background: #f41b1b; color: #fff; padding: 2px 5px; border-radius: 8px;",d.respone),e.$store.commit("update",{key:"progress.step",add:1}),l(null)})},function(r,l){r?console.log(r):e.$nextTick(function(){e.$store.commit("resetProgress"),s(null,t)})})}var Wi={methods:{filterBooksInSeries:function(e){let t=[];const s=_.get(e,"config"),i={library:_.find(_.get(s,"steps"),{name:"books"}),test:_.get(s,"seriesTest")},o=_.get(e,"books",[]);return i.library?t=_.filter(o,function(n){return n.isNewThisRound&&n.series}):i.test&&(t=_.filter(o,function(n){return n.series})),t},getDataFromSeriesPages:function(e,t){const s=this;let i=this.filterBooksInSeries(e);if(!i.length)this.$store.commit("update",{key:"subStep.step",add:3}),n();else{this.$store.commit("update",[{key:"progress.text",value:"Compiling a list of series pages..."},{key:"progress.step",value:0},{key:"progress.max",value:0},{key:"progress.bar",value:!0}]);let a=[];_.each(i,function(r){_.each(r.series,function(l){a.push({url:s.seriesUrl+"/"+l.asin+"?pageSize=50",asin:l.asin,books:[],allBooks:[],length:0})})}),a=_.uniqBy(a,"asin"),waterfall([function(r){s.getAllSeriesPages(a,r)},function(r,l){s.getBooksFromSeries(e,r,l)},function(r,l){s.getMissingNumbers(e,r,l)}],function(r,l){o(),_.each(l,function(c){const f=_.find(a,{asin:c.asin});f&&(f.books=f.books.concat(c.books),f.allBooks=f.allBooks.concat(c.allBooks),f.length+=c.length,delete f.pageNumbers,delete f.pageSize,delete f.url)});const d=_.get(e,"series",[]);s.$store.state.storageHasData.books&&d.length?_.each(a,function(c){const f=_.find(d,{asin:c.asin});f?_.merge(f,c):e.series.push(c)}):e.series=a,r&&console.error("%cerror","background: #f41b1b; color: #fff; padding: 2px 5px; border-radius: 8px;",r),n()})}function o(){s.$store.commit("update",[{key:"subStep.step",value:0},{key:"subStep.max",value:0}]),s.$store.commit("resetProgress")}function n(){o(),s.$nextTick(function(){t(null,e)})}},getAllSeriesPages:function(e,t){this.$store.commit("update",{key:"subStep.step",add:1});const s=this;s.amapxios({requests:e,step:function(i,o,n){n.pageNumbers=s.getPageNumbers(i),n.pageSize="50",s.$store.commit("update",{key:"progress.max",add:1}),o(n)},flatten:!0,done:function(i,o){let n=[];_.each(i,function(a){_.each(a.pageNumbers,function(r){const l=JSON.parse(JSON.stringify(a));let d=new Url(DOMPurify.sanitize(l.url));d.query.page=r,d.query.pageSize=a.pageSize,l.url=d.toString();const c=d.path.split("/");l.requestId=c[c.length-1],n.push(l)})}),t(null,n)}})},getBooksFromSeries(e,t,s){const i=this;this.$store.commit("update",[{key:"progress.text",value:"Fetching series order..."},{key:"progress.max",value:t.length},{key:"subStep.step",add:1}]),i.amapxios({requests:t,step:function(o,n,a){const r=$($.parseHTML(o.data)).find("div.adbl-main")[0];o.data=null;let l=null;const d=r.querySelectorAll(".adbl-impression-container li.productListItem");d.length>0&&(l={asin:a.asin,books:[],allBooks:[],length:d.length},each(d,function(c){let f;const u=c.querySelector("div[data-asin]");let p=DOMPurify.sanitize(c.getAttribute("aria-label")),y,k=c.querySelector(".subtitle");if(k?(k=DOMPurify.sanitize(k.textContent.trimAll()),y=p+": "+k):(y=p,p=!1),y===p&&(p=!1),u){const b=u.getAttribute("data-asin");c.querySelector(".adblBuyBoxInLibraryButton")&&l.books.push(DOMPurify.sanitize(b))}else{const b=_.get(e,"books",[]);y&&(f=_.find(b,{title:y})),f||(f=_.find(b,{titleShort:p})),f&&l.books.push(f.asin)}let h={};u?h.asin=DOMPurify.sanitize(u.getAttribute("data-asin")):f&&(h.asin=f.asin),y&&(h.title=y),p&&(h.titleShort=p);let w=c.querySelector(":scope > div:nth-child(1) > div > h2");if(w&&(w=w.textContent),w&&(h.bookNumbers=DOMPurify.sanitize(w.trimAll().replace(/[^\d]*/,"").split(",")[0])),!f&&!c.querySelector(".adblBuyBoxInLibraryButton")&&(h.notInLibrary=!0),c.querySelector('[name="discovery-add-to-library-form"]')&&(h.plus=!0),c.querySelector(".buybox-regular-price")){let b=c.querySelector(".buybox-regular-price").textContent.match(/\d/g);_.map(b,function(P){return parseFloat(P)}).reduce((P,q)=>P+q,0)===0&&(h.free=!0)}if(!h.bookNumbers){let b;h.title&&(b=h.title.match(/(?:, Book.)(.+)/)),b&&(b=b[1]),b&&(h.bookNumbers=b.replace(/\)$/,""))}h.bookNumbers||(h.bookNumbers=function(b,S,D){const P=_.find(b,{asin:D});if(!P)return;const q=_.find(P.series,{asin:S});if(!!q)return _.isArray(q.bookNumbers)?q.bookNumbers.join(","):q.bookNumbers}(e.books,a.asin,h.asin)),h.bookNumbers||(h.bookNumbers="\u221E"),l.allBooks.push(h)})),i.$store.commit("update",{key:"progress.step",add:1}),n(l)},flatten:!0,done:function(o){s(null,o)}})},getMissingNumbers:function(e,t,s){let i=[];_.each(t,function(n){let a=_.filter(n.allBooks,{bookNumbers:"\u221E"});a.length&&(a=_.map(a,function(r){return{requestUrl:window.location.origin+"/pd/"+r.asin,seriesAsin:n.asin,bookAsin:r.asin}}),i=i.concat(a))}),this.$store.commit("update",[{key:"progress.text",value:"Attempting to fetch missing numbers from store pages..."},{key:"progress.step",value:0},{key:"progress.max",value:i.length},{key:"progress.bar",value:!0},{key:"subStep.step",add:1}]);let o=this;o.amapxios({requests:i,returnCatch:!0,step:function(n,a,r){let l=null;const d=_.get(n,"status",0);if(d>=200&&d<400){let c=$($.parseHTML(n.data)),f=c.find("div.adbl-main")[0];if(c=null,f&&f.querySelector('[id^="sample-player-"] > button')){const u=f.querySelector(".seriesLabel");let p=o.getSeries(u);p&&(p=_.find(p,{asin:r.seriesAsin}));const y=_.get(p,"bookNumbers");y&&(l={seriesAsin:r.seriesAsin,asin:r.bookAsin,bookNumbers:_.isArray(y)?y.join(","):y})}}o.$store.commit("update",{key:"progress.step",add:1}),a(l)},flatten:!0,done:function(n){n=_.omitBy(n,_.isNull),_.each(n,function(a){let r=_.find(t,{asin:a.seriesAsin});if(r){let l=_.find(r.allBooks,{asin:a.asin});l&&(l.bookNumbers=a.bookNumbers)}}),s(null,t)}})},fetchMissingNumbers:function(e,t,s){let i=this;i.amapxios({requests:_.map(e,function(o){return{requestUrl:window.location.origin+"/pd/"+o.asin,seriesAsin:t.asin,bookAsin:o.asin}}),step:function(o,n,a){let r=null;const l=_.get(o,"status",0);if(l>=200&&l<400){let d=$($.parseHTML(o.data)),c=d.find("div.adbl-main")[0];if(d=null,c&&c.querySelector('[id^="sample-player-"] > button')){const f=c.querySelector(".seriesLabel");let u=i.getSeries(f);u&&(u=_.find(u,{asin:a.seriesAsin}));const p=_.get(u,"bookNumbers");p&&(r={seriesAsin:a.seriesAsin,asin:a.bookAsin,bookNumbers:_.isArray(p)?p.join(","):p})}}console.log("missing numbers step done!"),n(r)},flatten:!0,done:function(o){_.each(o,function(n){let a=_.find(t.allBooks,{asin:n.asin});a&&(a.bookNumbers=n.bookNumbers)}),console.log("Fetched missing numbers!"),i.$store.commit("update",{key:"progress.step",add:1}),s(t)}})}}},Vi={methods:{getDataFromCollections:function(e,t){if(!_.find(e.config.steps,{name:"collections"}))this.$store.commit("resetProgress"),t(null,e);else{this.$store.commit("update",[{key:"bigStep.title",value:"Collections"},{key:"bigStep.step",add:1},{key:"progress.text",value:"Fetching collections..."},{key:"progress.step",value:0},{key:"progress.max",value:0},{key:"progress.bar",value:!0}]);const s=this;waterfall([function(i){s.uniteBooksInCollections(e,i)},s.fetchCollectionDetails],function(i,o){e.collections=o,s.$store.commit("resetProgress"),s.$nextTick(function(){t(null,e)})})}},uniteBooksInCollections:function(e,t){const s=_.filter(e.books,"collectionIds"),i=[],o=this;_.each(s,function(n){_.each(n.collectionIds,function(a){let r=_.find(i,{id:a});r||(r={id:a,url:o.collectionsUrl+"/"+a,books:[]},i.push(r),o.$store.commit("update",{key:"progress.max",add:1})),r&&r.books.push(n.asin)})}),t(null,i)},fetchCollectionDetails:function(e,t){const s=this;this.amapxios({requests:e,step:function(i,o,n){const a=$($.parseHTML(i.data)).find("div.adbl-main")[0];let r=a.querySelector("#center-3 > div.bc-container > div > div > span > ul > li:nth-child(1) > span.bc-text.bc-size-headline2");r&&(r=r.textContent),r&&(n.title=r);let l=a.querySelector("#center-3 > div.bc-container > div > div > span > ul > li.bc-list-item.summaryLabel.bc-spacing-s0_5 > span");l&&(l=l.textContent),l&&(n.description=l),s.$store.commit("update",{key:"progress.step",add:1}),o(n)},flatten:!0,done:function(i){_.each(i,function(o){o.url&&delete o.url}),t(null,i)}})},getFirstLevelCollectionData:function(e,t){const s=this;s.$store.commit("update",[{key:"progress.text",value:"Fetching collections..."},{key:"progress.step",value:0},{key:"progress.max",value:0},{key:"progress.bar",value:!0}]),s.amapxios({requests:e,step:function(i,o){s.scrapeFirstLevelCollectionData(i,o)},flatten:!0,done:function(i){t(null,i)}})},scrapeFirstLevelCollectionData:function(e,t){const s=this,i=$($.parseHTML(e.data)).find("div.adbl-main")[0];e.data=null;const o=[],n=i.querySelectorAll("#adbl-lib-col-main > .adbl-library-collection-row");each(n,function(a){if(a.querySelector(".product-image-grid-container:not(.empty-product-image-grid)")){let l={};const d=a.getAttribute("data-collection-id");l.id=DOMPurify.sanitize(d);const c=a.querySelector(".bc-size-headline3");c&&(l.title=DOMPurify.sanitize(c.textContent));const f=a.querySelector("ul .bc-text.bc-size-body.bc-color-secondary");f&&(l.description=DOMPurify.sanitize(f.textContent)),l.books=[],o.push(l)}s.$store.commit("update",{key:"progress.max",add:1})}),t(o)},getAllCollectionBookPages:function(e,t){const s=this;_.each(e,function(i){i.url=s.collectionsUrl+"/"+i.id+"?pageSize=50"}),s.amapxios({requests:e,step:function(i,o,n){s.scrapingPrep({url:i.request.responseURL||n.url,skipFirstCall:!0,response:i,done:function(a){s.$store.commit("update",{key:"progress.max",add:1}),n.pageNumbers=a.pageNumbers,n.pageSize=a.pageSize,n.url=a.urlObj.toString(),o(n)}})},flatten:!0,done:function(i,o){let n=[];o?console.log(o):_.each(i,function(a){_.each(a.pageNumbers,function(r){const l=JSON.parse(JSON.stringify(a));let d=new Url(DOMPurify.sanitize(l.url));d.query.page=r,d.query.pageSize=a.pageSize,l.url=d.toString(),n.push(l)})}),t(null,n,i)}})},getFirstLevelCollectionPages:function(e){this.scrapingPrep({url:this.collectionsUrl,done:function(t){const s=_.map(t.pageNumbers,function(i){return t.urlObj.query.page=i,t.urlObj.toString()});e(null,s)}})}}},Zi={methods:{getDataFromWishlist:function(e,t){if(!_.find(e.config.steps,{name:"wishlist"}))this.$store.commit("resetProgress"),t(null,e);else{this.$store.commit("update",[{key:"bigStep.title",value:"Wishlist"},{key:"bigStep.step",add:1},{key:"subStep.step",value:1},{key:"subStep.max",value:2},{key:"progress.text",value:this.$store.state.storageHasData.wishlist?"Updating old books and adding new books...":"Scanning wishlist for books..."},{key:"progress.step",value:0},{key:"progress.max",value:0}]);const s=this;waterfall([function(i){s.scrapingPrep({url:s.wishlistUrl,returnResponse:!0,returnAfterFirstCall:!0,done:function(o){const n=$($.parseHTML(o.response.data)).find("div.adbl-main")[0],a=parseFloat(DOMPurify.sanitize(n.querySelector(".adbl-library-refinement-section > div.bc-col-responsive.bc-col-2 > span").textContent.match(/\d+/)[0]));delete o.response;const r=o.pageSize?Math.ceil(a/o.pageSize):1;o.pageNumbers=_.range(1,r+1),i(null,o)}})},function(i,o){s.amapxios({requests:_.map(i.pageNumbers,function(n){return i.urlObj.query.page=n,i.urlObj.toString()}),step:function(n,a){s.getBooksWishlist(n,e,a)},flatten:!0,done:function(n){o(null,n)}})}],function(i,o){o.length&&(e.wishlist=o),s.$nextTick(function(){e.config.getStorePages="wishlist",t(null,e)})})}},getBooksWishlist:function(e,t,s){let i=this;const o=$($.parseHTML(e.data)).find("div.adbl-main")[0];e.data=null;const n=[],a=o.querySelectorAll("#adbl-library-content-main li.productListItem");$(a).each(function(){const r=this;let l=r.querySelector("[data-asin]");if(l&&(l=l.getAttribute("data-asin")),l||(l=r.querySelector('[id^="product-list-flyout-"]'),l&&(l=l.getAttribute("id").replace("product-list-flyout-",""))),l=DOMPurify.sanitize(l),t.books?!_.find(t.books,{asin:l}):!0){let c=_.find(t.wishlist,["asin",l]),f=i.$store.state.storageHasData.wishlist&&!c||!i.$store.state.storageHasData.wishlist,u=i.$store.state.storageHasData.wishlist&&c?c:{};u.asin=l;let p=r.querySelector(":scope > div:nth-child(1) > div > div > div > div > div > span > ul > li:nth-child(1) > a");if(p){let h=p.getAttribute("href");h=DOMPurify.sanitize(h);let w=new Url(window.location.origin+h);w.clearQuery(),u.storePageRequestUrl=w.toString()}if(f){const h=r.querySelector(":scope > div:nth-child(1) > div > div > div > div > div > span > ul > li:nth-child(2) > span.bc-color-secondary");h&&(u.subtitle=DOMPurify.sanitize(h.textContent.trimAll())),p&&(p=p.textContent.trimAll(),u.titleShort=DOMPurify.sanitize(p),u.title=u.subtitle?p+": "+u.subtitle:p);const w=r.querySelector('[data-trigger^="product-list-flyout"]');if(w){const ee=w.querySelector(":scope > a");if(ee){let j=ee.getAttribute("src");if(j=DOMPurify.sanitize(j),j.lastIndexOf("img-coverart-prod-unavailable")<0){let W=j.match(/\/images\/I\/(.*)._SL/);W=_.get(W,"[1]"),W&&(u.cover=W)}}}const b=r.querySelector("[data-mp3]");b&&(u.sample=DOMPurify.sanitize(b.getAttribute("data-mp3")));const S=r.querySelector(".seriesLabel > span");S&&(u.series=i.getSeries(S));const D=r.querySelector(".runtimeLabel > span");D&&(u.length=i.shortenLength(D.textContent));const P=r.querySelector(".releaseDateLabel > span");P&&(u.releaseDate=i.fixDates(P));const q=r.querySelectorAll(".authorLabel > a");q.length>0&&(u.authors=i.getArray(q));const z=r.querySelectorAll(".narratorLabel > a");z.length>0&&(u.narrators=i.getArray(z));const B=r.querySelector(".languageLabel");B&&(u.language=DOMPurify.sanitize(B.textContent.trimToColon()))}if(r.querySelector(".ratingsLabel")){const w=r.querySelector(".bc-review-stars").nextElementSibling,b=w.nextElementSibling;u.rating=Number(DOMPurify.sanitize(w.textContent.match(/^\d\.?(\d)?/g))),u.ratings=parseFloat(DOMPurify.sanitize(b.textContent.match(/\d/g).join("")))}if(r.querySelector(".discovery-add-to-library-button")&&(u.fromPlusCatalog=!0),u=_.omitBy(u,_.isNull),i.$store.state.storageHasData.books){let h=!c,w=c&&c.isNew;(h||w)&&(u.isNew=!0)}f&&(u.isNewThisRound=!0,i.$store.commit("update",{key:"progress.max",add:1})),n.push(u)}}),s(n)}}},Gi={methods:{getDataFromPurchaseHistory:function(e,t){const s=this;s.scrapingPrep({url:s.purchaseHistoryUrl,maxSize:20,done:function(i){i.urlObj.toString(),console.log(i)}})}}};const Ji={mixins:[Ce,qe,zi,Bi,Hi,Ri,Ei,Ui,Wi,Vi,Zi,Gi,Y],data:function(){return{store:this.$store.state,libraryUrl:window.location.origin+"/library/titles",libraryUrlFin:window.location.origin+"/library/titles?isFinished=true",seriesUrl:window.location.origin+"/series",collectionsUrl:window.location.origin+"/library/collections",wishlistUrl:window.location.origin+"/library/wishlist",purchaseHistoryUrl:window.location.origin+"/account/purchase-history",domainExtension:window.location.hostname.replace("www.audible",""),newBooks:[],library:{books:[],storePageMissing:[]},ui:"menu-screen",doStorePageTest:[],doSeriesTest:[]}},beforeMount:function(){this.$compEmitter.on("start-extraction",e=>{this["init_step_"+e.step](e.config)}),_.get(this.doStorePageTest,"length",0)>0&&this.init_storePageTest(),_.get(this.doSeriesTest,"length",0)>0&&this.init_seriesPageTest()},methods:{init_step_extract:function(e){const t=this;chrome.storage.local.get(null).then(s=>{s.chunks&&s.chunks.length&&t.glueFriesBackTogether(s),t.ui="scraping",t.$nextTick(function(){s=s||{},s.books&&(e.oldBooksLength=s.books.length),s.config=e;const i=[function(n){n(null,s)},t.getDataFromLibraryPages,t.getDataFromStorePages,t.getDataFromSeriesPages,t.getDataFromCollections,t.getDataFromWishlist,t.getDataFromStorePages,t.getISBNsFromGoogleBooks],o=e.steps?_.filter(e.steps,function(n){return n.value}).length:i.length-1;t.$store.commit("update",{key:"bigStep.max",value:o}),waterfall(i,function(n,a){t.$store.commit("resetProgress"),t.$store.commit("update",[{key:"bigStep.title",value:"Opening the gallery after packing up the data..."},{key:"bigStep.step",value:0},{key:"bigStep.max",value:0},{key:"subStep.step",value:0},{key:"subStep.max",value:0}]),t.goToOutputPage(a)})})})},init_step_update:function(e){e.partialScan=!0,e.steps=[{name:"library",value:!0}],this.init_step_extract(e)},init_step_output:function(e){let t={config:e,extras:{"domain-extension":this.domainExtension}};chrome.storage.local.set(t).then(()=>{this.goToOutputPage({useStorageData:!0})})},goToOutputPage:function(e){let t=e.collections,s=t?_.find(t,{id:"__ARCHIVE"}):null;s&&(s.description="");let i=function(n){e[n]&&_.each(e[n],function(a){a.storePageRequestUrl&&delete a.storePageRequestUrl,a.isNewThisRound&&delete a.isNewThisRound,a.requestUrl&&delete a.requestUrl,n==="books"&&a.asin&&s&&s.books.length>0&&_.includes(s.books,a.asin)&&(a.archived=!0)})};i("books"),i("wishlist");const o=window.location.origin+window.location.pathname;if(e.books&&e.books.length&&e.wishlist&&e.wishlist.length&&_.remove(e.wishlist,function(n){if(n.asin)return _.find(e.books,{asin:n.asin})}),e.useStorageData)chrome.runtime.sendMessage({action:"openOutput",url:o});else{if(e.config&&(e.config.steps||e.config.extraSettings)){let n=e.config.steps,a=e.config.extraSettings;e.config={},n&&(e.config.steps=n),a&&(e.config.extraSettings=a)}this.addDataVersions(e),e.chunks||(e.books&&this.addedOrder(e.books),e.wishlist&&this.addedOrder(e.wishlist),this.makeFrenchFries(e)),chrome.storage.local.clear().then(()=>{chrome.storage.local.set(e).then(()=>{chrome.runtime.sendMessage({action:"openOutput",url:o})})})}},addDataVersions:function(e){_.isObject(e.version)||(e.version={});let t=this.store.storageHasData,s=chrome.runtime.getManifest().version;_.find(e.config.steps,{name:"library",value:!0})&&!t.books&&(e.version.library=s),_.find(e.config.steps,{name:"collections",value:!0})&&!t.collections&&(e.version.collections=s),_.find(e.config.steps,{name:"wishlist",value:!0})&&!t.wishlist&&(e.version.wishlist=s)},init_purchaseHistoryTest:function(){const e={config:{test:!0,getStorePages:"books"}};this.getDataFromPurchaseHistory(e,function(t,s){console.log("%cPurchase history test","background: #00bb1e; color: #fff; padding: 2px 5px; border-radius: 8px;",s)})},init_storePageTest:function(){const e=this;console.log("%casdfasdf","background: green; color: #fff; padding: 2px 5px; border-radius: 8px;",this.doStorePageTest);const t={config:{test:!0,getStorePages:"books",seriesTest:!0},books:this.doStorePageTest};console.log("%casdfasdf","background: orange; color: #fff; padding: 2px 5px; border-radius: 8px;",t);const s=[function(i){i(null,t)},e.getDataFromStorePages,e.getDataFromSeriesPages];console.log("waterfall","waterfall"),waterfall(s,function(i,o){e.$store.commit("resetProgress"),e.$store.commit("update",[{key:"bigStep.title",value:"Opening the gallery after packing up the data..."},{key:"bigStep.step",value:0},{key:"bigStep.max",value:0}]),console.log("%cStore page test","background: #00bb1e; color: #fff; padding: 2px 5px; border-radius: 8px;",o)})},init_seriesPageTest:function(){const e=this,t={config:{seriesTest:!0},books:this.doSeriesTest};e.getDataFromSeriesPages(t,function(s,i){console.log("%cSeries page test","background: #00bb1e; color: #fff; padding: 2px 5px; border-radius: 8px;",i.series)})}}};function Qi(e,t,s,i,o,n){const a=Fi,r=et,l=Ue;return m(),T(l,null,{default:J(()=>[e.ui==="menu-screen"?(m(),T(a,{key:0,domainExtension:e.domainExtension,wishlistUrl:e.wishlistUrl},null,8,["domainExtension","wishlistUrl"])):e.ui==="scraping"?(m(),T(r,{key:1})):U("",!0)]),_:1})}var Yi=F(Ji,[["render",Qi]]),V=fe({state:{appVersion:"0.2.9",localStorageName:"ale-content-script-settings",canceledRequests:[],progress:{text:null,textSuffix:null,text2:null,step:0,max:0,bar:!1,thumbnail:null},bigStep:{title:"",step:0,max:0},subStep:{step:0,max:0},storageHasData:{books:null,isbn:null,wishlist:null,collections:null},toastOpts:{position:"top",duration:4e3},storageConfig:{},dataVersion:null,extractBtnDisabled:!1,extractionButtonDisabled:!1,extractSettings:[{label:"Library",name:"books",value:!0,disabled:!0,type:"is-success",tippy:"Library is required in order to extract collections and isbn.",trashTippy:"This will also remove Collections and ISBN data.",kind:"main",deleteChunks:["books","series","collections"],partialData:!0},{label:"Collections",name:"collections",parent:"books",value:!0,disabled:!1,type:"is-success",tippy:"Very quick extraction that just needs to check the first page of each collection to find out the title and description",kind:"main",partialData:!0},{label:"Wishlist",name:"wishlist",value:!1,disabled:!1,type:"is-success",tippy:"Similar to library extraction but series order is not fetched. Books that also exist in your library are dropped off as long as you also extract library data.",kind:"main",partialData:!0},{label:"ISBN",name:"isbn",parent:"books",value:!1,disabled:!1,type:"is-danger",tippy:"International Standard Book Numbers (ISBN) are required if you want to try importing your library to Goodreads. ISBNs are fetched for library books only. Very slow extraction time.",kind:"main",partialData:!0},{name:"saveStandaloneAfter",value:!1,label:"Start saving the standalone gallery immediately after extraction",kind:"extra"}],axiosRateLimit:{maxRequests:20,perMilliseconds:1e3},failedRequests:[]},mutations:{fromLocalStorage:function(e){let t=localStorage.getItem(e.localStorageName);if(t&&t!="undefined"){t=JSON.parse(t);const s=_.map(t,function(i){return{disabled:i.disabled,value:i.value}});_.merge(e.extractSettings,s)}},update(e,t){let s=function(i){if(i=i||{},i.key){let o=i.value;i.add&&(o=(_.get(e,i.key)||0)+i.add),o=i.freeze?Object.freeze(o):o,_.set(e,i.key,o)}};_.isArray(t)?_.each(t,function(i){s(i)}):s(t)},resetProgress:function(e){e.progress.text=null,e.progress.textSuffix=null,e.progress.text2=null,e.progress.step=0,e.progress.max=0,e.progress.bar=!1,e.progress.thumbnail=null},pushToCanceledRequests:function(e,t){e.canceledRequests.push(t)},updateSetting:function(e,t){t=_.isArray(t)?t:[t],_.each(t,function(s){const i=_.find(e.extractSettings,{name:s.item.name});_.merge(i,s.obj)})},pushToFailedRequests(e,t){e.failedRequests.push(t)}},getters:{settings_mainSteps:function(e){return _.filter(e.extractSettings,{kind:"main"})},settings_extras:function(e){return _.filter(e.extractSettings,{kind:"extra"})},mainDataExists:function(e){return e.storageHasData.books||e.storageHasData.wishlist},setting:e=>t=>_.find(e.extractSettings,{name:t}),partialDataSettings(e,t){const s=_.filter(t.settings_mainSteps,{partialData:!0}),i=_.map(s,"name"),o=_.map(i,n=>_.get(e.storageHasData,n));return _.every(o,!0)},partialDataSettings(e,t){const s=_.filter(t.settings_mainSteps,{partialData:!0}),i=_.map(s,"name");return _.map(i,o=>_.get(e.storageHasData,o))},partialDataSettings_all(e,t){return _.every(t.partialDataSettings,!0)},partialDataSettings_any(e,t){return _.includes(t.partialDataSettings,!0)}}});chrome.runtime.sendMessage({pageAction:!0});window.$=H;window._=R;window.axios=pe;window.exponentialDelay=he;window.isNetworkOrIdempotentRequestError=me;window.axiosRetry=be;window.dateFormat=_e;window.DOMPurify=ye;window.asyncMap=xe;window.asyncMapLimit=ve;window.waterfall=ke;window.Url=Se;String.prototype.trimAll=function(){return this?this.trim().replace(/\s+/g," "):null};String.prototype.trimToColon=function(){return this?this.substring(this.indexOf(":")+1).trim():null};window.each=function(e,t){if(!e)return null;for(var s=0;s<e.length;s++)t(e[s],s)};const N=we(Yi);N.config.globalProperties.$compEmitter=new $e;N.config.globalProperties.$dataChecker=function(e,t){t=this.$store||t;const s=R.get(e,"chunks",[]);s.length>0,t.commit("update",[{key:"storageHasData.books",value:s.indexOf("books")>-1},{key:"storageHasData.isbn",value:s.indexOf("isbn")>-1?i(e):!1},{key:"storageHasData.wishlist",value:s.indexOf("wishlist")>-1},{key:"storageHasData.collections",value:s.indexOf("collections")>-1},{key:"storageConfig",value:e.config||{}},{key:"dataVersion",value:e.version||null}]);function i(o){let n=!1;return R.each(R.range(0,o["books-chunk-length"]),function(a){const r=o["books-chunk-"+a];if(R.find(r,"isbns"))return n=!0,!1}),n}};N.use(De);N.use(Pe,{directive:"tippy",component:"tippy",componentSingleton:"tippy-singleton",defaultProps:{placement:"auto-end",allowHTML:!0,arrow:!0,placement:"top",trigger:"mouseenter focus",theme:"light-border",zIndex:9999999991,delay:[500,0],a11y:!1,maxWidth:670,onShow:e=>!!e.props.content,boundary:"viewport",flipDuration:0}});N.config.productionTip=!1;N.config.devtools=!1;let re=H("<a>",{id:"audible-library-extractor-btn",class:"bc-link bc-tab-heading bc-inline-block bc-tab-lens bc-size-title1 bc-color-secondary",tabindex:"0",role:"tab","aria-selected":!1,href:"#",text:"Audible Library Extractor",css:{height:"33px",lineHeight:"33px",fontSize:"14px",padding:"0 4px 0 15px",borderRadius:"4px",textDecoration:"none",background:"#f7991c",color:"#fff",boxShadow:"0 2px 4px rgb(0 0 0 / 10%), 0 2px 10px rgb(0 0 0 / 10%)",display:"inline-flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",fontWeight:"900",width:"232px",margin:"10px 0px -8px"}}),X=H(".library-header-divider").next().find("#lib-subheader-actions");X.css({display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"center"});re.appendTo(X);H("#center-2 > div > div").css({marginTop:"10px"});X.parent().css({display:"flex",flexDirection:"row",alignItems:"flex-end",justifyContent:"flex-start"});let K=H("<i>",{class:"bc-icon bc-icon-fill-base bc-icon-chevron-right-s4 bc-icon-chevron-right bc-icon-size-large bc-color-base",ariaHidden:"true"});K[0].setAttribute("style","font-weight: 900 !important");K.css({verticalAlign:"center",color:"white",fontSize:"23px",width:"28px",height:"28px",display:"inline-flex",flexDirection:"row",alignItems:"center",justifyContent:"center"});K.appendTo(re);H("#audible-library-extractor-btn").on("click",function(e){e.preventDefault(),chrome.storage.local.get(null).then(t=>{oe(t)})});chrome.runtime.onMessage.addListener(e=>{e.iconClicked&&chrome.storage.local.get(null).then(t=>{oe(t)})});function oe(e){V.commit("fromLocalStorage"),V.subscribe(function(t,s){localStorage.setItem(s.localStorageName,JSON.stringify(s.extractSettings))}),H("<div>",{id:"audible-library-extractor"}).prependTo("body"),N.config.globalProperties.$dataChecker(e,V),N.directive("visible",function(t,s){t.style.visibility=s.value?"visible":"hidden"}),N.use(V),N.mount("#audible-library-extractor")}
