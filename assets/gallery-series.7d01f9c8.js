import{_ as B}from"./gallery-lazy.719d725f.js";import{a as M}from"./gallery-search.f26482dc.js";import{f as N}from"./gallery-findSubPageSource.65b5640c.js";import{_ as w,c as m,d as k,a as g,F as D,j as F,n as v,e as h,r as R,b as O,o as p,i as $,k as x,t as b,w as W,g as C}from"./lodash.1321b47a.js";import"./gallery.9619b8b4.js";import"./gallery-makeCoverUrl.8378190f.js";import"./jquery.050764e9.js";import"./index.ee874ed1.js";import"./content-script-helpers.e49fc91b.js";import"./howler.22814ddb.js";import"./tippy.82bfa66a.js";import"./gallery-page-title.a786f9b3.js";import"./gallery-timeStringToSeconds.9aa0cb6a.js";const I={name:"aleSeries",mixins:[N],data:function(){return{collectionSource:"pageCollection",pageTitle:"Series",pageSubTitle:null,listReady:!1}},computed:{optionsOpenMargin:function(){return this.$store.state.searchOptOpenHeight?{marginBottom:0}:!1},galleryStyle:function(){return this.$store.state.searchOptOpenHeight?{overflow:"hidden",height:this.$store.state.searchOptOpenHeight-this.$refs.wrapper.offsetTop*2+"px"}:!1}},methods:{makeCollection:function(){const o=this,t=[],e=this.$store.state.library.series;let r=1;_.eachRight(o.subPageSource.collection,function(s){s.series&&_.each(s.series,function(a){const c=_.find(t,{asin:a.asin}),l=_.find(e,{asin:a.asin}),n=c!=null?c:{name:a.name,asin:a.asin,books:[],added:r++,authors:s.authors,narrators:s.narrators,publishers:s.publishers,minRating:_.toNumber(s.myRating)};if(l){let f=function(u){return u.split("-").map(_.toNumber).filter(_.isFinite)},i=function(u){return _.flatMap(u.map(y=>f(y.bookNumbers)))},d=function(u){return _.max(i(u))};l.allBooksMinusDupes=o.removeDuplicates(l.allBooks);const S=l.allBooksMinusDupes.filter(u=>l.books.some(y=>y===u.asin));n.allBooksMinusDupes=l.allBooksMinusDupes,n.myMaxBookNumber=d(S),n.maxBookNumber=d(l.allBooksMinusDupes),n.missingLatest=n.myMaxBookNumber<n.maxBookNumber,n.minRating=_.min([n.minRating,s.myRating].map(_.toNumber).filter(u=>!_.isNaN(u)))}n.books.push(s.title||s.shortTitle),c||t.push(n)})}),_.reverse(t),this.$store.commit("prop",{key:"pageCollection",value:t}),this.updateListRenderingOptions(),this.listReady=!0},updateListRenderingOptions:function(){let o=this,t={scope:[{active:!0,key:"name",tippy:"Search series by name",weight:5},{active:!0,key:"books",tippy:"Search series by book titles",weight:1},{active:!0,key:"authors.name",tippy:"Search series by authors",weight:1},{active:!0,key:"narrators.name",tippy:"Search series by narrators",weight:1},{active:!0,key:"publishers.name",tippy:"Search series by publishers",weight:1}],filter:[{active:!1,type:"filterExtras",label:"Number of books",key:"inSeries",range:[1,function(){let e=_.get(o.$store.state,o.collectionSource),r=_.maxBy(e,function(s){if(s.books)return s.books.length});return r?r.books.length:1}()],rangeMinDist:0,rangeSuffix:"",rangeMin:function(){return 1},rangeMax:function(){let e=_.get(o.$store.state,o.collectionSource),r=_.maxBy(e,function(s){if(s.books)return s.books.length});return r?r.books.length:1},condition:function(e){if(e.books){let r=this.range[0],s=this.range[1];return e.books.length>=r&&e.books.length<=s}}},{excludeFromWishlist:!0,type:"divider",key:"divider1.0"},{excludeFromWishlist:!0,active:!1,type:"filterExtras",label:"Rating (min)",tippy:"Based on the book you rated lowest in the series",key:"min-rating",condition:function(e){return(e.minRating||0)>=this.range[0]},range:!0,rangeMin:()=>1,rangeMax:()=>5,rangeMinDist:0,rangeSuffix:"",tooltipFormatter:function(e){switch(e){case 1:return e+" (Not for me)";case 2:return e+" (It\u2019s okay)";case 3:return e+" (Pretty good)";case 4:return e+" (It\u2019s great)";case 5:return e+" (I love it)";default:return 0}}},{excludeFromWishlist:!0,type:"divider",key:"divider1.1"},{excludeFromWishlist:!0,active:!1,type:"filterExtras",label:"Incomplete series",key:"series-incomplete",tippy:"Series where I don't own all the books",condition:function(e){return e.allBooksMinusDupes.length>e.books.length}},{excludeFromWishlist:!0,type:"divider",key:"divider1.2"},{excludeFromWishlist:!0,active:!1,type:"filterExtras",label:"Missing latest book",key:"missing-latest",condition:e=>e==null?void 0:e.missingLatest}],sort:[{active:!1,key:"randomize",label:"Randomize",type:"sortExtras",tippy:"Ignores sorting and randomizes instead unless there's an active search."},{type:"divider",key:"divider1"},{active:!0,current:!0,key:"added",label:"Added",type:"sort",tippy:'<div style="text-align: left;"><small>&#9650;</small> Old at the top <br><small style="display: inline-block; transform: rotate(180deg);">&#9650;</small> New at the top</div>'},{active:!0,current:!1,key:"name",label:"Name",type:"sort",tippy:"Sort by series name"},{active:!1,current:!1,key:"amount",label:"Number of books",type:"sort"},{excludeFromWishlist:!0,active:!1,current:!1,key:"amountTotal",label:"Total number of books",type:"sort"},{excludeFromWishlist:!0,active:!1,current:!1,key:"missing",label:"Missing",tippy:"Number of missing books",type:"sort"}]};this.subPageSource.wishlist&&(t.filter=_.filter(t.filter,function(e){return!e.excludeFromWishlist}),t.sort=_.filter(t.sort,function(e){return!e.excludeFromWishlist})),this.$setListRenderingOpts(t)},removeDuplicates:function(o){let t=_.clone(o);var e=0;return _.each(t,function(r){r.order=++e}),t=_.groupBy(t,"bookNumbers"),_.each(t,function(r,s){if(r.length===1)t[s]=[r[0]];else{var a=_.filter(r,function(c){return!c.notInLibrary});a.length>0?t[s]=a:t[s]=[r[0]]}}),t=_.map(t,function(r){return r}),t=_.flatten(t),t=_.orderBy(t,"order","asc"),t}}},L={key:0,class:"books-total",content:"Total number of books I have in this series."},T={key:0};function z(o,t,e,r,s,a){const c=M,l=R("router-link"),n=B,f=O("tippy");return o.listReady?(p(),m("div",{key:0,id:"ale-series",class:"box-layout-wrapper",style:v(a.optionsOpenMargin),ref:"wrapper"},[k(c,{collectionSource:o.collectionSource},null,8,["collectionSource"]),g("div",{style:v(a.galleryStyle),class:"page-content"},[(p(!0),m(D,null,F(o.$store.getters.collection,(i,d)=>(p(),$(n,{class:"single-box","data-asin":i.asin,key:"series:"+i.asin},{default:x(()=>[k(l,{to:{name:"series",params:{series:i.asin},query:{subPageSource:o.subPageSource.name}}},{default:x(()=>[g("h2",null,b(i.name),1),i.books&&i.books.length?W((p(),m("div",L,[g("span",{class:C({"my-books":i.allBooksMinusDupes&&i.allBooksMinusDupes.length})},b(i.books.length),3),i.allBooksMinusDupes&&i.allBooksMinusDupes.length?(p(),m("span",T,"\xA0of\xA0"+b(i.allBooksMinusDupes.length),1)):h("",!0)])),[[f,{placement:"right"}]]):h("",!0)]),_:2},1032,["to"])]),_:2},1032,["data-asin"]))),128))],4)],4)):h("",!0)}var Y=w(I,[["render",z],["__scopeId","data-v-75906f58"]]);export{Y as default};
